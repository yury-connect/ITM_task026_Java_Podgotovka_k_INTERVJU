# üåâ Spring Proxy: _–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ_

![–æ–ª–∏—Ü–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω-–ø–∞—Ç–µ—Ä–∞ PROXY](/ITM/ITM06_Spring/otc/Spring_proxy/2025-04-25_15-14-43.png)

[_–í–∏–¥–µ–æ-–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ._](https://youtu.be/DKNDU7OjyJs?t=541)

### PROXY —á—Ç–æ —ç—Ç–æ, –¥–ª—è —á–µ–≥–æ –∏ –∫–∞–∫ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ Spring

**–ü–∞—Ç—Ç–µ—Ä–Ω –ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å** (_Proxy_) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç-–∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç 
–¥–æ—Å—Ç—É–ø–æ–º –∫ –¥—Ä—É–≥–æ–º—É –æ–±—ä–µ–∫—Ç—É. –¢–æ –µ—Å—Ç—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç-—Å—É—Ä—Ä–æ–≥–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç 
–≤—ã—Å—Ç—É–ø–∞—Ç—å –≤ —Ä–æ–ª–∏ –¥—Ä—É–≥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∏ –∑–∞–º–µ—â–∞—Ç—å –µ–≥–æ (_–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã_).  

![—Å–ø—Ä–∞–≤–∫–∞](/ITM/ITM06_Spring/otc/Spring_proxy/2025-04-25_15-26-31.png)

<details>
        <summary>–ø—Ä–∏–º–µ—Ä ‚Üí</summary>

```java
// –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä
public interface Image {
    void display();
}

    public class RealImage implements Image {
        public void display() {
    System.out.println("Displaying real image");
    }
}

public class ProxyImage implements Image {
    private RealImage realImage;

    public void display() {
        if (realImage == null) {
            realImage = new RealImage(); // –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        }
        realImage.display();
    }
}
```
</details>


–í _Spring_ –ø—Ä–æ–∫—Å–∏ –ø—Ä–æ—Å—Ç–æ **–æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç** `bean`, 
–æ–Ω –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É **–¥–æ** –∏ **–ø–æ—Å–ª–µ** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤.
- üõ°Ô∏è –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç **–¥–æ—Å—Ç—É–ø** –∫ —Ü–µ–ª–µ–≤–æ–º—É –æ–±—ä–µ–∫—Ç—É
- ‚ú® –î–æ–±–∞–≤–ª—è–µ—Ç **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É** (_–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å_)
- üé≠ –ü–æ–ª–Ω–æ—Å—Ç—å—é **–ø—Ä–æ–∑—Ä–∞—á–µ–Ω** –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞

---
## üß© –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Proxy –≤ Spring
### 1. JDK Dynamic Proxy
#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
* –ö–æ–≥–¥–∞ –±–∏–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ Spring AOP

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
* ‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
* üîå –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
* üèéÔ∏è –û–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

### 2. CGLIB Proxy
#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
* –ö–æ–≥–¥–∞ –±–∏–Ω –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
* –ü—Ä–∏ —è–≤–Ω–æ–º —É–∫–∞–∑–∞–Ω–∏–∏ proxy-target-class=true

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
* üß¨ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
* üö´ –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å final –∫–ª–∞—Å—Å–∞–º–∏/–º–µ—Ç–æ–¥–∞–º–∏
* üèóÔ∏è –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

---

<details>
        <summary>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∫—Å–∏ –≤ Spring</summary>

```java
@Configuration
@EnableAspectJAutoProxy(proxyTargetClass = true) // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CGLIB
public class AppConfig {
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∏–Ω–æ–≤
}
```

```xml
<!-- XML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è -->
<aop:config proxy-target-class="true">
    <!-- Pointcut –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è -->
</aop:config>
```
</details>

### üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

<details>
        <summary>–ü—Ä–∏–º–µ—Ä —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏</summary>

```java
@Service
public class UserService {
    @Transactional // Spring —Å–æ–∑–¥–∞—Å—Ç –ø—Ä–æ–∫—Å–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
    public User createUser(String name) {
        // –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    }
}
```
</details>

<details>
        <summary>–ê–û–ü —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π</summary>

```java
@Aspect
@Component
public class LoggingAspect {
    @Around("@annotation(Loggable)")
    public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable {
        long start = System.currentTimeMillis();
        Object result = joinPoint.proceed();
        long duration = System.currentTimeMillis() - start;
        System.out.println(joinPoint.getSignature() + " executed in " + duration + "ms");
        return result;
    }
}
```
</details>

---
### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ JDK vs CGLIB

| –ö—Ä–∏—Ç–µ—Ä–∏–π      | 	`JDK Dynamic Proxy`  | 	`CGLIB Proxy`       |
|:--------------|:----------------------|:---------------------|
| –û—Å–Ω–æ–≤–∞        | 	–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã           | 	–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ        |
| –°–∫–æ—Ä–æ—Å—Ç—å      | 	–ë—ã—Å—Ç—Ä–µ–µ —Å–æ–∑–¥–∞–Ω–∏–µ     | 	–ë—ã—Å—Ç—Ä–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ  |
| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è   | 	–¢—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å    | 	–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å final |
| –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | 	–õ–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è          | 	–¢—è–∂–µ–ª–æ–≤–µ—Å–Ω–∞—è        |

---
### üí° –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
* **–î–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã + JDK Proxy
* **–î–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** - CGLIB –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
* **–ò–∑–±–µ–≥–∞–π—Ç–µ** self-invocation –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ–º—ã—Ö –±–∏–Ω–æ–≤
* **–ü–æ–º–Ω–∏—Ç–µ** –æ final –º–µ—Ç–æ–¥–∞—Ö –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ CGLIB

---
### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* –î–ª—è **short-lived** –æ–±—ä–µ–∫—Ç–æ–≤ - JDK Proxy
* –î–ª—è **long-lived** –æ–±—ä–µ–∫—Ç–æ–≤ - CGLIB
* –î–ª—è **–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫ perfomance** —É—á–∞—Å—Ç–∫–æ–≤ - —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ AspectJ compile-time weaving


---
**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—ã JDK –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ**, –∫–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å –≤—ã–±–æ—Ä.

–ï—Å–ª–∏ —Ü–µ–ª–µ–≤–æ–π –æ–±—ä–µ–∫—Ç –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Ç–æ –±—É–¥–µ—Ç
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–∫—Å–∏ JDK**. –í—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–ª–µ–≤—ã–º
—Ç–∏–ø–æ–º, –±—É–¥—É—Ç –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã.                             

![–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç dynamic proxy](/ITM/ITM06_Spring/otc/Spring_proxy/2025-04-25_15-32-37.png)

–ï—Å–ª–∏ —Ü–µ–ª–µ–≤–æ–π –æ–±—ä–µ–∫—Ç **–Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä **CGLIB**.

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ CGLIB 
(–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –¥–ª—è —Ü–µ–ª–µ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, 
–∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏), –≤—ã –º–æ–∂–µ—Ç–µ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å.

–ß—Ç–æ–±—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ CGLIB, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–∞ 
**proxy-target-class** —ç–ª–µ–º–µ–Ω—Ç–∞ **\<aop:config>** –∑–Ω–∞—á–µ–Ω–∏–µ true.

![Spring AOP - –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä](/ITM/ITM06_Spring/otc/Spring_proxy/2025-04-25_15-38-27.png)





---

–∑–∞–≥–æ—Ç–æ–≤–∫–∏: 

<details>
        <summary>–ø—Ä–∏–º–µ—Ä ‚Üí</summary>

```java

```
</details>


