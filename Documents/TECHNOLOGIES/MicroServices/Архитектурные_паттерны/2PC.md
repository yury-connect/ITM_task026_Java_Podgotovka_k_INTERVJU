# **ะะฐััะตัะฝ 2PC** (*Two-Phase Commit*)

**ะะตัะฐะฝะธะทะผ ะฐัะพะผะฐัะฝัั ัะฐัะฟัะตะดะตะปัะฝะฝัั ััะฐะฝะทะฐะบัะธะน**

---
## **๐น ะกััั**
2PC ะณะฐัะฐะฝัะธััะตั, ััะพ ะฒัะต ััะฐััะฝะธะบะธ ััะฐะฝะทะฐะบัะธะธ ะปะธะฑะพย**ัะธะบัะธัััั (commit)**, ะปะธะฑะพย**ะพัะบะฐััะฒะฐัั (rollback)**ยะธะทะผะตะฝะตะฝะธั.  
ะะฐะฑะพัะฐะตั ะฒย**ะดะฒะต ัะฐะทั**:
1. **ะคะฐะทะฐ ะณะพะปะพัะพะฒะฐะฝะธั (Prepare Phase)**    
    - ะะพะพัะดะธะฝะฐัะพั ัะฟัะฐัะธะฒะฐะตั ะฒัะตั ััะฐััะฝะธะบะพะฒ:ย_ยซะะพะถะตัะต ะฒัะฟ-ัั ััะฐะฝะทะฐะบัะธั?ยป_      
    - ะฃัะฐััะฝะธะบะธ ะพัะฒะตัะฐััย**ยซะะฐยป**ย(ะณะพัะพะฒั) ะธะปะธย**ยซะะตัยป**ย(ะฝะต ะณะพัะพะฒั).    
2. **ะคะฐะทะฐ ะฒัะฟะพะปะฝะตะฝะธั (Commit/Rollback Phase)**    
    - ะัะปะธ ะฒัะต ะณะพะปะพัะพะฒะฐะปะธ ยซะะฐยป โ ะบะพะพัะดะธะฝะฐัะพั ะบะพะผะฐะฝะดัะตัย**ยซCommitยป**.        
    - ะัะปะธ ัะพัั ะฑั ะพะดะธะฝ ยซะะตัยป โย**ยซRollbackยป**ยะดะปั ะฒัะตั.        

---
## **๐น ะฃัะฐััะฝะธะบะธ**
- **ะะพะพัะดะธะฝะฐัะพั (Coordinator)**ยโ ัะฟัะฐะฒะปัะตั ะฟัะพัะตััะพะผ (ะฝะฐะฟัะธะผะตั, ะพัะดะตะปัะฝัะน ัะตัะฒะธั ะธะปะธ ะกะฃะะ).    
- **ะฃัะฐััะฝะธะบะธ (Participants)**ยโ ัะตัะฒะธัั ะธะปะธ ะะ, ะฒัะฟะพะปะฝัััะธะต ััะฐะฝะทะฐะบัะธั.    

---
## **๐น ะะปััั ะธ ะผะธะฝััั**

|**ะัะตะธะผััะตััะฒะฐ**|**ะะตะดะพััะฐัะบะธ**|
|---|---|
|**ะัะพะผะฐัะฝะพััั**ย(ะฒัะต ะธะปะธ ะฝะธัะตะณะพ)|**ะะปะพะบะธัะพะฒะบะธ**ย(ัะตััััั ะทะฐะผะพัะพะถะตะฝั ะดะพ ะบะพะฝัะฐ 2PC)|
|**ะกััะพะณะฐั ัะพะณะปะฐัะพะฒะฐะฝะฝะพััั**|**ะะตะดะปะตะฝะฝัะน**ย(ะธะท-ะทะฐ ัะธะฝััะพะฝะธะทะฐัะธะธ)|
|ะะพะดัะพะดะธั ะดะปัย**ะบัะพัั-ัะตัะฒะธัะฝัั ััะฐะฝะทะฐะบัะธะน**|**ะะธัะบ ะทะฐะฒะธัะฐะฝะธะน**ย(ะตัะปะธ ะบะพะพัะดะธะฝะฐัะพั ัะฟะฐะป)|

---
## **๐น ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั?**
- **ะขัะฐะฝะทะฐะบัะธะธ ะผะตะถะดั ัะฐะทะฝัะผะธ ะะ**ย(ะฝะฐะฟัะธะผะตั, PostgreSQL + MongoDB).    
- **ะัะธัะธัะฝัะต ะพะฟะตัะฐัะธะธ**ย(ะฑะฐะฝะบะพะฒัะบะธะต ะฟะตัะตะฒะพะดั, ะฑัะพะฝะธัะพะฒะฐะฝะธั).    
- **ะะพะณะดะฐ Saga ะฝะต ะฟะพะดัะพะดะธั**ย(ะฝัะถะฝะฐ ะผะณะฝะพะฒะตะฝะฝะฐั ัะพะณะปะฐัะพะฒะฐะฝะฝะพััั).    

---
## **๐น ะัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั**
1. **ะะปะพะบะธัะพะฒะบะธ (Locking)**    
    - ะฃัะฐััะฝะธะบะธ ะฑะปะพะบะธัััั ะดะฐะฝะฝัะต ะดะพ ะบะพะฝัะฐ 2PC โ ะฒะพะทะผะพะถะฝัย**ะดะตะดะปะพะบะธ**.        
    - **ะะตัะตะฝะธะต:**ยะขะฐะนะผะฐััั ะฝะฐ ะณะพะปะพัะพะฒะฐะฝะธะต.
        
2. **ะัะบะฐะท ะบะพะพัะดะธะฝะฐัะพัะฐ**    
    - ะัะปะธ ะบะพะพัะดะธะฝะฐัะพั ัะฟะฐะป ะฟะพัะปะต ยซPrepareยป, ััะฐััะฝะธะบะธ ะทะฐะฒะธัะฐัั.        
    - **ะะตัะตะฝะธะต:**        
        - **ะขะฐะนะผะฐััั**ย(ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะพัะบะฐั ะฟัะธ ะดะพะปะณะพะผ ะพะถะธะดะฐะฝะธะธ).            
        - **ะััะฝะฐะปะธัะพะฒะฐะฝะธะต**ย(ะบะพะพัะดะธะฝะฐัะพั ะฒะพัััะฐะฝะฐะฒะปะธะฒะฐะตั ัะพััะพัะฝะธะต ะฟะพัะปะต ัะฑะพั).
            
3. **ะะธะทะบะฐั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**    
    - **ะะตัะตะฝะธะต:**ยะัะฟะพะปัะทะพะฒะฐัั ัะพะปัะบะพ ะดะปั ะบะพัะพัะบะธั ััะฐะฝะทะฐะบัะธะน.        

---
## **๐น ะัะปะธัะธะต ะพั Saga**

|**ะัะธัะตัะธะน**|**2PC**|**Saga**|
|---|---|---|
|**ะกะพะณะปะฐัะพะฒะฐะฝะฝะพััั**|ะะณะฝะพะฒะตะฝะฝะฐั (ัััะพะณะฐั)|Eventual (ะฒ ะบะพะฝะตัะฝะพะผ ััััะต)|
|**ะะปะพะบะธัะพะฒะบะธ**|ะะฐ (ัะตััััั ะทะฐะผะพัะพะถะตะฝั)|ะะตั|
|**ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**|ะะธะทะบะฐั|ะััะพะบะฐั|
|**ะัะบะฐะทะพัััะพะนัะธะฒะพััั**|ะกะปะพะถะฝะฐั (ะบะพะพัะดะธะฝะฐัะพั โ SPOF)|ะัะพััะฐั (ะดะตัะตะฝััะฐะปะธะทะพะฒะฐะฝะพ)|

---
## **๐น ะะดะต ะฒัััะตัะฐะตััั?**
- **ะกะฃะะ:**ยXA-ััะฐะฝะทะฐะบัะธะธ (Oracle, PostgreSQL).    
- **ะคัะตะนะผะฒะพัะบะธ:**ยNarayana, Atomikos (ะดะปั Java).    
- **ะะฑะปะฐะบะฐ:**ยAWS Aurora, Google Spanner.    

---
**ะัะพะณ:**  
2PC โ ััะพย**ยซะถะตััะบะธะตยป ััะฐะฝะทะฐะบัะธะธ**ยั ะณะฐัะฐะฝัะธัะพะฒะฐะฝะฝะพะน ะฐัะพะผะฐัะฝะพัััั.  
ะัะฟะพะปัะทัะนัะต, ะตัะปะธ:
- ะัะถะฝะฐย**ัััะพะณะฐั ัะพะณะปะฐัะพะฒะฐะฝะฝะพััั**.    
- ะะพะถะฝะพ ัะตัะฟะตััย**ะฑะปะพะบะธัะพะฒะบะธ**ยะธ ะฝะธะทะบัั ัะบะพัะพััั.    

**ะะปััะตัะฝะฐัะธะฒั:**
- **Saga**ยโ ะดะปั ะดะพะปะณะธั ะฟัะพัะตััะพะฒ.    
- **Saga + Outbox**ยโ ะดะปั ะธะฝัะตะณัะฐัะธะธ ั ะพัะตัะตะดัะผะธ.

---
