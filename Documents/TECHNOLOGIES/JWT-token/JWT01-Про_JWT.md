# ====Подробно про JWT====
# Термины

- Идентификация — процесс получения идентификатора пользователя: логин / e-mail /id    
- Аутентификация — подтверждение личности пользователя (с помощью пароля, отпечатка пальца, и т.п.)    
- Авторизация — предоставление прав пользователю, выдача токена    
- Валидация — процесс проверки «куска» информации на соответствие требованиям программы, или просто на совпадение с копией, хранимой в базе данных.    
- Токен — ключ аутентификации пользователя    
- Credentials — учетные данные пользователя: логин, пароль, google id, и т.п.    
- БД — база данных    
- Клиент — уровень представления данных (см клиент-серверная архитектура). Имеет графический интерфейс для взаимодействия с пользователем. пример: веб-сайт в интернете.    
- Сервер — уровень получения и обработки данных (см клиент-серверная архитектура). Не имеет графического интерфейса, принимает запросы от клиентов через API.    
- API — Application Program Interface, набор команд, позволяющий обратиться к приложению    
- Метод API — конкретная команда, позволяющая обратиться к приложению    
- Публичные методы API — те, которые доступны без аутентификации пользователя, например: главная страница сайта в интернете.    
- Защищенные методы API — требующие обязательной аутентификации пользователя, например: личный кабинет пользователя на сайте.    
- Эндпоинт — url адрес метода API в интернете    

---
# Что такое JWT

**JWT** (Json Web Token) — ключ аутентификации пользователя. Используется для запросов к защищенным методам API.

**Для чего нужны JWT**: чтобы не передавать учетные данные пользователя с каждым запросом к серверу.

**Чем JWT лучше учетных данных:**

1. Учетные данные пользователя, как правило хранятся долго (месяцы). Как бы хорошо не был зашифрован запрос, при достаточном количестве времени его можно расшифровать. Если запрос, содержащий учетные данные перехвачен злоумышленником, у него будет много времени на расшифровку. Токены доступа имеют ограниченный срок годности (обычно ~15 минут). Этого времени не достаточно, чтобы расшифровать надежный шифр. К тому времени, когда зловредный алогритм расшифрует запрос, токен уже выйдет из обращения и будет бесполезен.
    
2. Использовать учетные данные, это медленно. Для валидации учетных данных сервер должен запросить их сохраненную копию из БД и сравнить с данными, которые пришли в запросе. Обращение к БД — дорогостоящая процедура, она сильно увеличивает время обработки запроса. Токены, с другой стороны, не требуют обращения к БД для валидации. Это позволяет снизить нагрузку на БД и ускорить обработку запросов сервером.
    

**Время жизни токенов.** Каждый токен имеет определенный срок годности. Эта информация зашита в его теле. При валидации, сервер извлекает данные из токена и проверяет, не истек ли срок.

**Как хранить токены.** Существует мнение, что некоторые виды токенов нужно хранить в БД вместе с остальными данными, это не так. JWT были придуманы специально для того, чтобы не хранить их и не сверять с БД при каждом запросе. Валидация токенов происходит прямо на сервере. Как это реализовано, я расскажу ниже.

Оговорюсь: бывают ситуации, когда нам нужно отозвать токен до истечения его срока годности и добавить его в «черный список». Для хранения этого списка используют  
[In-Memory Cache](https://habr.com/ru/companies/otus/articles/502974) или специальную базу данных — [Redis](https://redis.io/) (см раздел "Black-list токенов").

### **Как передавать токены**

**от сервера к клиенту**:
- в теле запроса    
- либо используя заголовок «Set-Cookie»:   

```
Set-Cookie: accessToken=<jwt>; HttpOnly; Sequre; SameSite=Strict;
```

от клиента к серверу:

- в заголовке запроса «Authrorization» с добавлением слова Bearer
    

```
Authorization: Bearer <jwt>
```

- либо используя заголовок «Cookie»
    

```
Cookie: accessToken=<jwt>
```

## Виды JWT

- «access token» — проверяется при каждом обращении к защищенному API
    
    - многоразовый
        
    - присылается с каждым запросом к API в заголовке «authorization»
        
    - имеет короткий срок годности (обычно ~15 мин)
        
    - когда срок годности выходит, сервер возвращает #401
        
- «refresh token» — токен для получения новой пары токенов (access и refresh)
    
    - одноразовый
        
    - имеет длительный срок годности (обычно несколько дней)
        
    - отправляется клиентом на эндпоинт ~/auth/refresh, когда истечет срок годности access токена и сервер вернет #401
        
- «bearer token» — частный случай access токена. В рамках веб приложений эти термины можно использовать, как синонимы.