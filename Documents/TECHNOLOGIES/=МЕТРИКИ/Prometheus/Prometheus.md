### **Prometheus โ ััะพ ััะพ?**

**Prometheus**ยโ ััะพย**open-source ัะธััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ ะธ ะฐะปะตััะธะฝะณะฐ**, ัะพะทะดะฐะฝะฝะฐั ะดะปั ะฝะฐะดะตะถะฝะพะณะพ ัะฑะพัะฐ ะผะตััะธะบ ะธ ะฐะฝะฐะปะธะทะฐ ัะฐะฑะพัั ะฟัะธะปะพะถะตะฝะธะน ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ. ะะทะฝะฐัะฐะปัะฝะพ ัะฐะทัะฐะฑะพัะฐะฝะฝะฐั ะฒย**SoundCloud**, ัะตะนัะฐั ะพะฝะฐ ะฒัะพะดะธั ะฒย**CNCF**ย(*Cloud Native Computing Foundation*) ะธ ัะฒะปัะตััั ะพะดะฝะธะผ ะธะท ะบะปััะตะฒัั ะธะฝััััะผะตะฝัะพะฒ ะฒ ัะบะพัะธััะตะผะตย**Kubernetes**ยะธ ะผะธะบัะพัะตัะฒะธัะพะฒ.

---
## ๐นย**ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ Prometheus**

### 1.ย**ะกะฑะพั ะผะตััะธะบ (Pull-ะผะพะดะตะปั)**
Prometheusย**ะฟะตัะธะพะดะธัะตัะบะธ ะพะฟัะฐัะธะฒะฐะตั**ย(*HTTP-ะทะฐะฟัะพัั*) ัะตะปะตะฒัะต ัะตัะฒะธัั, ะบะพัะพััะต ะฟัะตะดะพััะฐะฒะปััั ะผะตััะธะบะธ ะฒ ัะฟะตัะธะฐะปัะฝะพะผ ัะพัะผะฐัะต.  
๐ ะัะธะผะตั: Spring Boot ะฟัะธะปะพะถะตะฝะธะต ัย`/actuator/prometheus`.

### 2.ย**ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั**
- ะัััะพะตะฝะฝะฐัย**ะฑะฐะทะฐ ะดะฐะฝะฝัั (TSDB โ Time Series Database)**ยะพะฟัะธะผะธะทะธัะพะฒะฐะฝะฐ ะดะปั ััะฐะฝะตะฝะธั ะฒัะตะผะตะฝะฝัั ััะดะพะฒ.    
- ะะพะดะดะตัะถะธะฒะฐะตั ัััะตะบัะธะฒะฝะพะต ัะถะฐัะธะต ะดะฐะฝะฝัั.    

### 3.ย**ะะธะฑะบะธะน ัะทัะบ ะทะฐะฟัะพัะพะฒ โ PromQL**
ะะพะทะฒะพะปัะตั ะฐะฝะฐะปะธะทะธัะพะฒะฐัั ะผะตััะธะบะธ ั ะฟะพะผะพััั ะผะพัะฝัั ะทะฐะฟัะพัะพะฒ, ะฝะฐะฟัะธะผะตั:
```promql
http_requests_total{status="500"}  # ะกะบะพะปัะบะพ ะฑัะปะพ 500-ั ะพัะธะฑะพะบ?
node_memory_usage_bytes / 1024 / 1024  # ะะฐะผััั ะฒ MB
```

### 4.ย**ะะธะทัะฐะปะธะทะฐัะธั (Grafana + Prometheus)**
Prometheus ัะฐะผ ะธะผะตะตั ะฟัะพััะพะน UI, ะฝะพ ัะฐัะต ะตะณะพ ะธัะฟะพะปัะทััั ะฒะผะตััะต ัย**Grafana**ยะดะปั ะบัะฐัะธะฒัั ะดะฐัะฑะพัะดะพะฒ.

### 5.ย**ะะปะตััะธะฝะณ (Alertmanager)**
- ะะพะถะฝะพ ะฝะฐัััะฐะธะฒะฐัั ะฟัะฐะฒะธะปะฐ (ะฝะฐะฟัะธะผะตั, "ะตัะปะธ CPU > 90% ะฑะพะปััะต 5 ะผะธะฝัั โ ะพัะฟัะฐะฒะธัั ัะฒะตะดะพะผะปะตะฝะธะต").    
- ะะพะดะดะตัะถะธะฒะฐะตัย**Slack, Email, PagerDuty**ยะธ ะดััะณะธะต ัะธััะตะผั ะพะฟะพะฒะตัะตะฝะธั.    

---
## ๐นย**ะััะธัะตะบัััะฐ Prometheus**

[https://prometheus.io/assets/architecture.png](https://prometheus.io/assets/architecture.png)

1. **Prometheus Server**ยโ ัะดัะพ (ัะฑะพั, ััะฐะฝะตะฝะธะต, ะทะฐะฟัะพัั).    
2. **Targets**ยโ ะฟัะธะปะพะถะตะฝะธั/ัะตัะฒะธัั, ะบะพัะพััะต ะพัะดะฐัั ะผะตััะธะบะธ (ะฝะฐะฟัะธะผะตั, Spring Boot + Micrometer).    
3. **Service Discovery**ยโ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต ัะตัะฒะธัะพะฒ (Kubernetes, Consul, AWS EC2).    
4. **Alertmanager**ยโ ะพะฑัะฐะฑะพัะบะฐ ะธ ะพัะฟัะฐะฒะบะฐ ะฐะปะตััะพะฒ.    
5. **Grafana**ยโ ะฒะธะทัะฐะปะธะทะฐัะธั.    

---
## ๐นย**ะะฐะบ Prometheus ัะพะฑะธัะฐะตั ะผะตััะธะบะธ?**

### 1.ย**Pull vs Push**
- **Prometheus ะธัะฟะพะปัะทัะตั Pull-ะผะพะดะตะปั**ย(ัะฐะผ ัะพะดะธั ะทะฐ ะผะตััะธะบะฐะผะธ ะฟะพ ัะฐัะฟะธัะฐะฝะธั).    
- ะะปััะตัะฝะฐัะธะฒะฐ:ย**Push-ะผะพะดะตะปั**ย(ะบะฐะบ ะฒ Graphite), ะณะดะต ะฟัะธะปะพะถะตะฝะธั ัะฐะผะธ ะพัะฟัะฐะฒะปััั ะดะฐะฝะฝัะต.    

### 2.ย**ะคะพัะผะฐั ะผะตััะธะบ**
ะะฐะฝะฝัะต ะดะพะปะถะฝั ะฑััั ะฒ ัะพัะผะฐัะต:
```plaintext
http_requests_total{method="GET", status="200"} 42
http_requests_total{method="POST", status="500"} 3
```
๐ Spring Boot ั Micrometer ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะตะดะพััะฐะฒะปัะตั ัะฐะบะพะน endpoint (`/actuator/prometheus`).

### 3.ย**ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ**ย(`prometheus.yml`)
```yaml
global:
  scrape_interval: 15s  # ะะฐะบ ัะฐััะพ ัะพะฑะธัะฐัั ะผะตััะธะบะธ

scrape_configs:
  - job_name: "spring-boot-app"
    metrics_path: "/actuator/prometheus"
    static_configs:
      - targets: ["localhost:8080"]  # ะะดัะตั ะฟัะธะปะพะถะตะฝะธั
```

## ๐นย**Prometheus vs Grafana**

|**Prometheus**|**Grafana**|
|---|---|
|ะกะฑะพั ะธ ััะฐะฝะตะฝะธะต ะผะตััะธะบ|ะะธะทัะฐะปะธะทะฐัะธั ะผะตััะธะบ|
|ะกะฒะพะน ัะทัะบ ะทะฐะฟัะพัะพะฒ (PromQL)|ะะพะดะดะตัะถะบะฐ ัะฐะทะฝัั ะธััะพัะฝะธะบะพะฒ (Prometheus, InfluxDB, Elasticsearch)|
|ะััั ะฟัะพััะพะน UI|ะัะฐัะธะฒัะต ะดะฐัะฑะพัะดั ั ะณัะฐัะธะบะฐะผะธ|
๐ย**ะะฝะธ ะพัะปะธัะฝะพ ัะฐะฑะพัะฐัั ะฒะผะตััะต!**

---
## ๐นย**ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั**

### 1.ย**ะะพะฝะธัะพัะธะฝะณ Spring Boot ะฟัะธะปะพะถะตะฝะธั**

1. ะัะธะปะพะถะตะฝะธะต ะพัะดะฐะตั ะผะตััะธะบะธ ัะตัะตะทย`/actuator/prometheus`.    
2. Prometheus ัะฐะท ะฒ 15 ัะตะบ ะทะฐะฑะธัะฐะตั ะธั.    
3. Grafana ะฟะพะดะบะปััะฐะตััั ะบ Prometheus ะธ ัะธััะตั ะณัะฐัะธะบะธ.    

### 2.ย**ะะปะตััะธะฝะณ ะฟัะธ ะฒััะพะบะพะน ะทะฐะณััะทะบะต CPU**
```yaml
# alert.rules.yml
groups:
- name: example
  rules:
  - alert: HighCpuUsage
    expr: 100 - (avg by(instance)(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High CPU usage on {{ $labels.instance }}"
```
๐ Alertmanager ะฟะพะปััะธั ััะพั *ะฐะปะตัั* ะธ ะพัะฟัะฐะฒะธั ัะฒะตะดะพะผะปะตะฝะธะต ะฒ Slack.

---
## ๐นย**ะะปััั ะธ ะผะธะฝััั Prometheus**

### โย**ะัะตะธะผััะตััะฒะฐ**
- **ะัะพััะพัะฐ**ยโ ะปะตะณะบะพ ัะฐะทะฒะตัะฝััั ะธ ะฝะฐัััะพะธัั.    
- **ะะฐะดะตะถะฝะพััั**ยโ ัะฐะฑะพัะฐะตั ะดะฐะถะต ะฟัะธ ะพัะบะฐะทะต ะพัะดะตะปัะฝัั ัะตัะฒะธัะพะฒ (Pull-ะผะพะดะตะปั).    
- **ะะฝัะตะณัะฐัะธั ั Kubernetes**ยโ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะฐััะถะธะฒะฐะตั ะฟะพะดั.    
- **ะะพัะฝัะน PromQL**ยโ ัะปะพะถะฝะฐั ะฐะฝะฐะปะธัะธะบะฐ "ะธะท ะบะพัะพะฑะบะธ".    

### โย**ะะตะดะพััะฐัะบะธ**
- **ะะตั ะดะพะปะณะพััะพัะฝะพะณะพ ััะฐะฝะตะฝะธั**ย(*ะพะฑััะฝะพ ะดะฐะฝะฝัะต ััะฐะฝัั **15-30 ะดะฝะตะน***).    
- **ะะตั ะฟะพะปะฝะพัะตะฝะฝะพะณะพ distributed-ัะตะถะธะผะฐ**ย(*ะฝะพ ะตััั Thanos/Cortex ะดะปั ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั*).    

---
## ๐นย**ะะฐะบ ะฟะพะฟัะพะฑะพะฒะฐัั?**

1. **ะฃััะฐะฝะพะฒะบะฐ Prometheus**ย(Docker):
```bash
docker run -p 9090:9090 prom/prometheus
```
โ ะัะบัััั:ย`http://localhost:9090`

2. **ะะพะฑะฐะฒะธัั Spring Boot ะฒ ะบะพะฝัะธะณ**ย(`prometheus.yml`):
```yaml
scrape_configs:
  - job_name: "spring-app"
    metrics_path: "/actuator/prometheus"
    static_configs:
      - targets: ["host.docker.internal:8080"]  # ะะปั Docker ะฝะฐ Mac/Windows
```

3. **ะะพะดะบะปััะธัั Grafana**ยะธ ะธะผะฟะพััะธัะพะฒะฐัั ะดะฐัะฑะพัะดั (ะฝะฐะฟัะธะผะตั,ย[JVM Micrometer](https://grafana.com/grafana/dashboards/4701)).

---
## **ะัะฒะพะด**

**Prometheus**ยโ ััะพ:  
๐ย**ะะพัะฝะฐั ัะธััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ**ยะดะปั ัะฑะพัะฐ ะผะตััะธะบ.  
๐ย**ะะธะฑะบะธะน ะฐะฝะฐะปะธะท**ยัะตัะตะท PromQL.  
๐ย**ะะฝัะตะณัะฐัะธั ั ะฐะปะตััะธะฝะณะพะผ**ย(Alertmanager + Slack/Email).  
๐ย**ะัััะธะน ะฒัะฑะพั ะดะปั Kubernetes ะธ ะผะธะบัะพัะตัะฒะธัะพะฒ**.

ะัะปะธ ะฝัะถะฝะพย**ะผะพะฝะธัะพัะธัั Spring Boot, ัะตัะฒะตัั ะธะปะธ ะพะฑะปะฐัะฝัั ะธะฝััะฐััััะบัััั**ยโ Prometheus + Grafana ะธะดะตะฐะปัะฝะพ ะฟะพะดัะพะดัั!







