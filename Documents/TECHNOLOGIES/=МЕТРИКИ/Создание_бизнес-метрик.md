–°–æ–∑–¥–∞–Ω–∏–µ¬†**–±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫**¬†(*–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤, –∫–æ–Ω–≤–µ—Ä—Å–∏—è, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫*) –≤ Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º¬†**Micrometer**¬†–∏¬†**Prometheus**¬†–≤–∫–ª—é—á–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –º–µ—Ç—Ä–∏–∫–∏ ¬´*–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π*¬ª.

---
## üîπ¬†**1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏**
–í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –∏–∑–º–µ—Ä—è—Ç—å:
- **–°—á–µ—Ç—á–∏–∫ (Counter)**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä,¬†`orders.created`).    
- **–¢–∞–π–º–µ—Ä (Timer)**: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä,¬†`payment.processing.time`).    
- **–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ (DistributionSummary)**: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä,¬†`order.amount`).   

**–ü—Ä–∏–º–µ—Ä –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫**:
- `orders.total`¬†‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤.    
- `payments.success`¬†‚Äî —É—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏.    
- `user.registration`¬†‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.    

---
## üîπ¬†**2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏ –≤ Spring Boot**

### –ò—Å–ø–æ–ª—å–∑—É–µ–º¬†`MeterRegistry`¬†(*Micrometer*)
```java
import io.micrometer.core.instrument.Counter;
import io.micrometer.core.instrument.MeterRegistry;
import org.springframework.stereotype.Service;

@Service
public class PaymentService {
    private final Counter paymentSuccessCounter; 

    public PaymentService(MeterRegistry registry) {
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –º–µ—Ç—Ä–∏–∫—É
        paymentSuccessCounter = Counter.builder("payments.success")
            .description("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π")
            .tag("payment.method", "credit_card") // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ç–µ–≥–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            .register(registry);
    }

    public void processPayment(boolean isSuccess) {
        if (isSuccess) {
            paymentSuccessCounter.increment(); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
        }
    }
}
```

### **–¢–µ–≥–∏ (Tags)**
–ü–æ–∑–≤–æ–ª—è—é—Ç –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –º–µ—Ç–æ–¥—É –æ–ø–ª–∞—Ç—ã):
```java
paymentSuccessCounter = Counter.builder("payments.success")
    .tag("payment.method", "credit_card")
    .tag("currency", "USD")
    .register(registry);
```

---
## üîπ¬†**3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Prometheus**

1. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è Prometheus:
```xml
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

2. –í–∫–ª—é—á–∏—Ç–µ endpoint –≤¬†`application.yml`:
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health, info, prometheus, metrics
```

3. –ú–µ—Ç—Ä–∏–∫–∞ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞:  
`http://localhost:8080/actuator/prometheus`:
```plaintext
# HELP payments_success –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
# TYPE payments_success counter
payments_success{payment_method="credit_card"} 42
```

---
## üîπ¬†**4. –ó–∞–ø—Ä–æ—Å –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ¬†**PromQL**¬†–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
```promql
payments_success  # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
payments_success{payment_method="credit_card"}  # –¢–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–µ–¥–∏—Ç–Ω—ã—Ö –∫–∞—Ä—Ç
rate(payments_success[5m])  # –°–∫–æ—Ä–æ—Å—Ç—å –ø–ª–∞—Ç–µ–∂–µ–π (–∑–∞ 5 –º–∏–Ω—É—Ç)
```

---
## üîπ¬†**5. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Grafana**

1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä,¬†[Spring Boot Micrometer](https://grafana.com/grafana/dashboards/4701)).    
2. –î–æ–±–∞–≤—å—Ç–µ –≥—Ä–∞—Ñ–∏–∫ —Å –≤–∞—à–µ–π –º–µ—Ç—Ä–∏–∫–æ–π:
```promql
sum(rate(payments_success[1h])) by (payment_method)
```

1. [https://miro.medium.com/max/1400/1*QY2Oq7v7yXbR6JhA6ZQJvA.png](https://miro.medium.com/max/1400/1*QY2Oq7v7yXbR6JhA6ZQJvA.png)    

---
## üîπ¬†**6. –ü—Ä–∏–º–µ—Ä—ã –¥—Ä—É–≥–∏—Ö –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫**

### **1. –¢–∞–π–º–µ—Ä –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞**
```java
import io.micrometer.core.instrument.Timer;

private final Timer orderProcessingTimer;

public OrderService(MeterRegistry registry) {
    orderProcessingTimer = Timer.builder("order.processing.time")
        .description("–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞")
        .register(registry);
}

public void processOrder() {
    orderProcessingTimer.record(() -> {
        // –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞
    });
}
```

–ó–∞–ø—Ä–æ—Å –≤ PromQL:
```promql
histogram_quantile(0.95, rate(order_processing_time_seconds_bucket[5m]))
```

### **2. –ì–∏–±—Å—Ç–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞**
```java
import io.micrometer.core.instrument.DistributionSummary;

private final DistributionSummary orderAmountSummary;

public OrderService(MeterRegistry registry) {
    orderAmountSummary = DistributionSummary.builder("order.amount")
        .description("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—É–º–º –∑–∞–∫–∞–∑–æ–≤")
        .register(registry);
}

public void createOrder(double amount) {
    orderAmountSummary.record(amount);
}
```

–ó–∞–ø—Ä–æ—Å –≤ PromQL:
```promql
avg(order_amount_sum) / avg(order_amount_count)  # –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
```

---
## üîπ¬†**7. –ê–ª–µ—Ä—Ç–∏–Ω–≥ –Ω–∞ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏**

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ Prometheus (`alert.rules.yml`):
```yaml
groups:
- name: business_metrics
  rules:
  - alert: HighPaymentFailureRate
    expr: rate(payments_failed_total[5m]) / rate(payments_total[5m]) > 0.1
    for: 10m
    labels:
      severity: critical
    annotations:
      summary: "–í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π: {{ $value }}"
```

---
## üîπ¬†**–ò—Ç–æ–≥**

1. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –º–µ—Ç—Ä–∏–∫—É**¬†(*—Å—á–µ—Ç—á–∏–∫, —Ç–∞–π–º–µ—Ä, –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞*).    
2. **–î–æ–±–∞–≤—å—Ç–µ –∫–æ–¥**¬†—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º¬†`MeterRegistry`.    
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç**¬†–≤ `Prometheus`.    
4. **–í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ**¬†–≤ `Grafana`.    
5. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã**¬†–ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö.    

**–ì–æ—Ç–æ–≤–æ!**¬†–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. üìäüöÄ




