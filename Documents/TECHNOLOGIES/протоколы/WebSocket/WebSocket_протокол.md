**WebSocket** — это протокол для **постоянного двустороннего обмена данными** между клиентом (например, браузером) и сервером по одному TCP-соединению.

**Как это работает, по шагам:**
1. **Рукопожатие (Handshake) — "Знакомство по правилам"**    
    - Клиент отправляет обычный **HTTP-запрос** с специальными заголовками (`Upgrade: websocket`, `Connection: Upgrade`, `Sec-WebSocket-Key`).        
    - Это как сказать: _«Привет, сервер! Давай общаться не как обычно (HTTP), а по-новому (WebSocket)?»_        
    - Сервер, если поддерживает WebSocket, отвечает **HTTP-ответом 101 Switching Protocols** с нужными заголовками (`Sec-WebSocket-Accept`).        
    - Это ответ: _«Давай! Переключаемся на новый режим связи.»_        
    - **Важно:** На этом этапе используется HTTP, чтобы пройти через брандмауэры и прокси-серверы, которые привыкли к HTTP-трафику.
    
2. **Установка соединения**    
    - После успешного рукопожатия **TCP-соединение, которое использовалось для HTTP-запроса, не закрывается**, а переиспользуется для общения по протоколу WebSocket.        
    - Канал связи между клиентом и сервером **установлен и остается открытым**.
    
3. **Двусторонний обмен данными (Full-Duplex)**    
    - Теперь **и клиент, и сервер могут отправлять сообщения друг другу в любой момент** по этому постоянному соединению.        
    - Данные передаются в виде **кадров (frames)** с очень маленьким заголовком (минимальные накладные расходы).        
    - Не нужно каждый раз заново устанавливать соединение, как в HTTP. Сообщения летят «туда-обратно» практически мгновенно.
    
4. **Закрытие соединения**    
    - Любая из сторон может инициировать разрыв специальным кадром закрытия.

### Ключевые преимущества перед **HTTP**:
- **Низкая задержка (Low Latency):** Нет накладных расходов на повторное установление TCP-соединения и отправку заголовков HTTP с каждым запросом.
    
- **Сервер может инициировать отправку данных:** При HTTP сервер всегда ждет запроса от клиента. WebSocket позволяет серверу отправить данные клиенту, как только они появились (например, новое уведомление или изменение котировок).
    
- **Эффективность:** Заголовки WebSocket-сообщений намного меньше, чем HTTP-заголовков.    

### Итог простыми словами:
WebSocket — это как **телефонный разговор**.
1. Вы звоните (*делаете HTTP-рукопожатие*).
2. Соединяетесь и говорите «Алло».
3. **После этого вы можете говорить и слушать одновременно**, не вешая трубку после каждой фразы.

В то время как обычный HTTP — это как **общение через смс**: отправил сообщение -> ждешь ответ -> получил ответ -> отправил следующее.

**Где используется:** Онлайн-чаты, уведомления в реальном времени, multiplayer-игры, биржевые графики, совместное редактирование документов.



---
**WebSocket** — это как **телефонный разговор** после знакомства на сайте.

1. **Знакомство (рукопожатие):**    
    - Клиент говорит: «Давай дружить!» (обычный HTTP-запрос).        
    - Сервер отвечает: «Давай!» (специальный HTTP-ответ).        
    - **Всё. Подключение установлено.**
    
2. **Общение:**    
    - После этого **каждая сторона может говорить что угодно и когда захочет**.        
    - Не нужно каждый раз представляться и ждать ответа, как с обычными HTTP-запросами (где один спросил — другой ответил — разговор окончен).        
    - Данные летят **туда-сюда по одному и тому же «проводу»** быстро и без лишних церемоний.        

**Итог:** WebSocket создаёт **постоянное двустороннее соединение** между клиентом и сервером, чтобы они могли общаться в реальном времени без задержек. Как чат в мессенджере или онлайн-игра, где действия всех видны сразу.

---
