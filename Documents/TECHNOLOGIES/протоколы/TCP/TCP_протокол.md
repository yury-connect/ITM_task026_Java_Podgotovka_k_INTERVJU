**TCP** (*Transmission Control Protocol*) — это сетевой протокол транспортного уровня с установкой соединения, <u>гарантированной доставкой</u>, <u>упорядочиванием пакетов</u> и <u>контролем перегрузки</u>.

---
**Ключевые принципы и механизмы:**

1. **Установка соединения (3-way handshake):** Перед обменом данными клиент и сервер устанавливают логическое соединение.    
    - **SYN:** Клиент отправляет пакет с флагом SYN (Synchronize) и случайным sequence number.        
    - **SYN-ACK:** Сервер отвечает пакетом с флагами SYN и ACK (Acknowledgment), своим sequence number и номером подтверждения (ACK), равным sequence number клиента + 1.        
    - **ACK:** Клиент отправляет пакет с флагом ACK, подтверждающий sequence number сервера. После этого соединение установлено.
    
2. **Надежность и контроль ошибок:**    
    - **Подтверждение получения (Acknowledgements):** Получатель отправляет отправителю ACK-пакет с номером следующего ожидаемого байта, подтверждая успешное получение данных.        
    - **Таймауты и повторная передача (Retransmission):** Если отправитель не получил ACK в течение заданного времени, он повторно отправляет не подтвержденные данные.
    
3. **Управление потоком (Flow Control):** Механизм предотвращает переполнение буфера получателя. Получатель указывает в заголовке TCP поле **Window Size** — размер доступного буфера. Отправитель не может отправить данных больше, чем этот размер.
    
4. **Управление перегрузкой (Congestion Control):** Набор алгоритмов (например, Slow Start, Congestion Avoidance) для предотвращения перегрузки сети. Отправитель динамически подстраивает объем передаваемых данных на основе потерь пакетов (являющихся сигналом о перегрузке в сети).
    
5. **Упорядочивание пакетов:** Каждый байт данных имеет свой порядковый номер (Sequence Number). Получатель использует эти номера, чтобы собрать пакеты в правильном порядке, даже если они пришли в сети в неправильной последовательности.
    
6. **Разрыв соединения (4-way handshake):** Для завершения соединения каждая сторона отправляет пакет с флагом FIN (Finish) и получает на него подтверждение ACK.
    

**Аналогия:** TCP похож на надежную заказную доставку с курьером: вы получаете подтверждение заказа, отслеживаете посылку, и если что-то теряется, отправляется новая. В отличие от [UDP](../UDP/UDP_протокол.md), который похож на отправку обычной открытки — отправил и надеешься, что дойдет.

---
Представь, что ты звонишь другу по телефону.

1. **Установка связи (Звонок):** Ты звонишь, он снимает трубку и говорит «Алло!», ты отвечаешь «Привет!». Связь установлена.
    
2. **Надёжность (Переспрашивание):** Ты говоришь фразу. Если друг расслышал, он говорит «Ага, понял». Если ты не слышишь «Ага» — повторяешь фразу снова.
    
3. **Порядок (Нумерация):** Ты говоришь: «Предложение 1. Предложение 2. Предложение 3». Даже если из-за помех они долетели в порядке 2-1-3, друг соберёт их правильно, потому что ты их пронумеровал.
    
4. **Скорость (Не перекрикивать):** Ты следишь, успевает ли друг тебя понимать. Если он говорит «Погоди, я записываю!», ты замедляешься.
    

**Итог:** TCP — это общение с проверкой, всё ли дошло, в правильном ли порядке и с комфортной для собеседника скоростью. Как телефонный разговор или заказное письмо с уведомлением о вручении.

---
