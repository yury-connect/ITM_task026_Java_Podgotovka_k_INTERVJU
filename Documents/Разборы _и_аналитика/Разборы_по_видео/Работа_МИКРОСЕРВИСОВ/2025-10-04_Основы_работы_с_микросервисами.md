# Основы работы с микросервисами
Ссылка на само видео: [Основы работы с микросервисами](https://youtu.be/V4oFJ3LbW9s?si=sqGyeD9FSP9fNzJF)

---
# **Observability**
**Observability (Обсервабильность)** — это способность понимать внутреннее состояние системы по её внешним выходным данным *(логам, метрикам, трейсам)*, не заглядывая внутрь кода.

### Три столба **обсервабильности**:
1. **Метрики (Metrics)**    
    - Числовые данные о работе системы *(CPU, память, ошибки)*        
    - Пример: количество запросов в секунду        
2. **Логи (Logs)**    
    - Текстовые записи о событиях с временными метками        
    - Пример: "User 123 logged in at 14:30"        
3. **Трейсы (Traces)**    
    - Отслеживание пути запроса через распределённую систему        
    - Пример: запрос прошёл через API Gateway → Auth Service → Database        

### Чем отличается от мониторинга:
- **Мониторинг** — ты знаешь, какие проблемы искать    
- **Обсервабильность** — можешь найти неизвестные проблемы    

### Простая аналогия:
- **Мониторинг** — датчики давления в шинах (знаешь, что проверять)    
- **Обсервабильность** — возможность спросить у машины "что случилось?" и получить полный диагноз    

**Суть**: возможность задавать любые вопросы о системе постфактум, без деплоя нового кода.

---
# **MELT**
**MELT** (Metrics, Events, Logs, Traces) — современная модель обсервабильности, расширяющая классические "три столба".

### 1. **Metrics (Метрики)**
- **Что**: Числовые измерения во времени    
- **Примеры**:    
    - QPS (queries per second)        
    - Latency (задержка)        
    - Error rate (% ошибок)        
    - CPU/Memory usage        
- **Для чего**: Понимание трендов и алертинг    

### 2. **Events (События)**
- **Что**: Дискретные значимые действия в системе    
- **Примеры**:    
    - "User registered"        
    - "Payment processed"        
    - "Order shipped"        
- **Для чего**: Бизнес-аналитика и реакция на ключевые действия    

### 3. **Logs (Логи)**
- **Что**: Текстовые записи с контекстом и временными метками    
- **Примеры**:    
    - `ERROR: Database connection timeout`        
    - `INFO: Cache flushed, 1500 entries cleared`        
- **Для чего**: Детальная отладка и аудит    

### 4. **Traces (Трейсы)**
- **Что**: Распределённое отслеживание запросов через сервисы    
- **Примеры**:    
    - Запрос: `API Gateway` → `Auth` → `OrderService` → `Payment` → `DB`        
    - Время выполнения каждого этапа        
- **Для чего**: Понимание задержек в микросервисной архитектуре    

## Как MELT взаимодействует:
```text
Запрос → Trace (сквозной ID)
       → Events (UserLoggedIn, OrderCreated)
       → Metrics (increment request_count)
       → Logs (debug info from each service)
```

## Практическое применение:
**Проблема**: "Платежи медленно работают"
- **Traces**: Показывают, что задержка в PaymentService    
- **Metrics**: Показывают 95-й перцентиль latency вырос на 300%    
- **Logs**: "Payment gateway timeout after 5000ms"    
- **Events**: "PaymentFailed" события участились    

## Отличие от старой модели:
**Раньше**: Metrics + Logs (не хватало контекста)  
**Сейчас**: MELT (полная картина происходящего)

**MELT** даёт возможность не просто мониторить известные проблемы, а исследовать неизвестные — что и есть суть Observability.

---

- **Grafana** - это UI-панель для визуализации (мы просто присоединяем к ней свои компоненты)
- **Primiteus** - сбор метрик (кол-во запросов, ошибок...)
- **Loki** - через него мы получаем сбор и хранение логов от микросервисов
- **Tempo** - через него мы получаем сбор и хранение трейсов своих запросов
Все эти компоненты подключаются к Grafana.

**Grafana Alloy** — единый агент, который собирает **все данные** (метрики, логи, трейсы) из системы и отправляет в соответствующие бэкенды (Prometheus, Loki, Tempo).

```text
Приложения → Grafana Alloy → Prometheus/Loki/Tempo → Grafana (UI)
```
Все компоненты — часть **Grafana Stack (LGTM Stack)**:  
**L**oki (логи)  
**G**rafana (UI)  
**T**empo (трейсы)  
**M**imir (метрики, альтернатива Prometheus)

---
 **Nginx** — популярный балансировщик нагрузки (load balancer)
> Но также Nginx это:
> - **Веб-сервер** (как Apache)
> - **Прокси** (reverse/forward proxy)   
> - **Кеширующий сервер**
> - **API Gateway**
> - **WAF** (Web Application Firewall)

> Для балансировки использует алгоритмы:
> - Round Robin
> - Least Connections
> - IP Hash (для sticky sessions)

