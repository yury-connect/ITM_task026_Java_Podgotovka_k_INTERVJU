# **API Gateway** ‚Äî —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º –Ω—É–∂–µ–Ω *(–∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É)*

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** —à–ª—é–∑, —Å—Ç–æ—è—â–∏–π –Ω–∞ ¬´–≥—Ä–∞–Ω–∏—Ü–µ¬ª –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –±—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å.

---
## –ß—Ç–æ —Ä–µ—à–∞–µ—Ç (*–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ*)

- üîÄ **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** ‚Äî –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –Ω—É–∂–Ω–æ–º—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—É –ø–æ URL, –≤–µ—Ä—Å–∏–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∞–º, cookie, A/B-—Ñ–ª–∞–≥–∞–º.    
- üîê **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT, OAuth2 introspection, mTLS, –ø—Ä–æ–≤–µ—Ä–∫–∞ scope/roles.    
- üõ°Ô∏è **–ó–∞—â–∏—Ç–∞** ‚Äî rate-limiting, throttling, IP-whitelisting, WAF-–ø—Ä–∞–≤–∏–ª–∞.    
- ‚ôªÔ∏è **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** ‚Äî retries, circuit breaker, fallback-responses.    
- ‚ö° **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ GET-–æ—Ç–≤–µ—Ç–æ–≤, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (token introspection / public keys), —Å–Ω–∏–∂–∞—é—â–µ–µ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –±–µ–∫–µ–Ω–¥.    
- üîß **–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è** ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç (BFF).    
- üìä **Observability** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ (–¥–æ–±–∞–≤–ª—è–µ—Ç correlation id).    
- üì¶ **–ü–æ–ª–∏—Ç–∏–∫–∏ –≤–µ—Ä—Å–∏–π –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤** ‚Äî A/B, canary, blue/green rollout.    

---
## –ö–µ—à: —á—Ç–æ –∏ –∫–∞–∫ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å (*–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏*)

- ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å**: idempotent GET-–æ—Ç–≤–µ—Ç—ã, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã expensive lookups; **JWKS/public keys** –∏ (—Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é) —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã token introspection —Å TTL.
    
- ‚ö†Ô∏è **–ù–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å**: –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ Vary, –æ—Ç–≤–µ—Ç—ã —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è.
    
- üïí **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è**: TTL, ETag/If-None-Match, Cache-Control, explicit purge API.
    
- üß† **–•–∏—Ç—Ä–æ—Å—Ç—å –¥–ª—è —Å–æ–±–µ—Å–∞:** —Å–∫–∞–∂–∏ –ø—Ä–æ `Vary` header –∏ –ø—Ä–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–ª—é—á—É (URL + query + headers) ‚Äî —ç—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏—è.    

---
## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî –∫–∞–∫ –æ–±—ã—á–Ω–æ –¥–µ–ª–∞—é—Ç

1. Client ‚Üí Gateway: –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT (–ø–æ–¥–ø–∏—Å—å —á–µ—Ä–µ–∑ JWKS) –∏–ª–∏ call to Keycloak (introspection) –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
    
2. Gateway –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç `iss`, `aud`, `exp`, `scope` –∏ **–º–æ–∂–µ—Ç**:    
    - –ø—Ä–æ–∫–∏–Ω—É—Ç—å `Authorization` –¥–∞–ª—å—à–µ, –∏–ª–∏        
    - –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ service-to-service token (token exchange / client_credentials).
    
3. –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ ‚Äî mTLS –º–µ–∂–¥—É Gateway –∏ internal —Å–µ—Ä–≤–∏—Å–∞–º–∏.
    
4. –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å JWKS –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã introspection —Å –Ω–µ–±–æ–ª—å—à–∏–º TTL.    

---
## –ì–¥–µ –∏ –∫–∞–∫ —Ä–∞–∑–º–µ—â–∞—Ç—å

- Edge Gateway (–Ω–∞—Ä—É–∂–Ω—ã–π) ‚Äî –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫.    
- Internal Gateway / Sidecar ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, BFF-—Å–ª–æ–∏.    
- Pattern: API Gateway + Service Mesh (–¥–ª—è east-west traffic) ‚Äî gateway –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ north-south, mesh ‚Äî –∑–∞ –≤–Ω—É—Ç—Ä–∏–∫–ª–∞—Å—Ç–µ—Ä–Ω—É—é —Å–µ—Ç–∫—É.    

---
## –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (*–∫–æ—Ä–æ—Ç–∫–æ, –¥–ª—è —É–ø–æ–º–∏–Ω–∞–Ω–∏—è*)

- Open source: **Kong**, **Traefik**, **NGINX**, **Envoy** / **Istio** (as gateway), **Spring Cloud Gateway**, **Zuul**.    
- Cloud: **AWS API Gateway**, **Azure API Management**, **GCP API Gateway**.    

---
## –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- Gateway ‚Äî single point of entry: –Ω—É–∂–µ–Ω HA, autoscale –∏ –∫–µ—à-–∫–ª–∞—Å—Ç–µ—Ä.    
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ/—Ç—Ä–µ–π—Å–∏–Ω–≥ + correlation id –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.    
- –°—Ç–∞—Ä–∞—Ç—å—Å—è –Ω–µ –¥–µ–ª–∞—Ç—å –≤ Gateway —Ç—è–∂—ë–ª—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É ‚Äî —Ç–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è/–ø–æ–ª–∏—Ç–∏–∫–∏/–∞–≥—Ä–µ–≥–∞—Ü–∏—è.    
- –î–ª—è high-throughput: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–π LRU/Redis –∫–µ—à.    

---
## –ö–æ—Ä–æ—Ç–∫–∞—è –≤—ã–∂–∏–º–∫–∞ –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è (*30‚Äì45 —Å–µ–∫*)

¬´API Gateway ‚Äî —ç—Ç–æ —Ñ—Ä–æ–Ω—Ç –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤: –æ–Ω –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (JWT/Keycloak), —Å—Ç–∞–≤–∏—Ç rate-limit, –∫—ç—à–∏—Ä—É–µ—Ç idempotent GET-–æ—Ç–≤–µ—Ç—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã JWKS/introspection, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç retry/circuit-breaker –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏/–º–µ—Ç—Ä–∏–∫–∏. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º gateway –∫–∞–∫ —Å–ª–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏; —Ç—è–∂—ë–ª—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ—Å—Ç–∞–≤–ª—è–µ–º –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö.¬ª

---
## –ß—Ç–æ —É–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ–±—ã –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ

- –ö—ç—à–∏—Ä—É–µ—Ç–µ **JWKS** + **introspection** —Å TTL.    
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **token exchange** / client_credentials –¥–ª—è S2S-–≤—ã–∑–æ–≤–æ–≤.    
- Gateway + Service Mesh (Envoy/ Istio) –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è north-south –∏ east-west —Ç—Ä–∞—Ñ–∏–∫–∞.
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ `Vary`/ETag –∏ —É–º–µ–µ—Ç–µ –¥–µ–ª–∞—Ç—å purge –Ω–∞ invalidate.    

------
---
---
# –ö–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞ –¥–ª—è —Å–æ–±–µ—Å–∞ (*1‚Äì2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è*)

¬´API-Gateway ‚Äî —ç—Ç–æ —Ñ—Ä–æ–Ω—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤: –º–∞—Ä—à—Ä—É—Ç–∏–∑—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (JWT/Keycloak), —Å—Ç–∞–≤–∏—Ç rate-limit –∏ –∫—ç—à–∏—Ä—É–µ—Ç idempotent GET/—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã introspection/JWKS; —Ç—è–∂—ë–ª—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ—Å—Ç–∞–≤–ª—è–µ–º –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö.¬ª ‚úÖ

# –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π ‚Äî –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É

## 1) Spring Cloud Gateway (application.yml + Security)

**`application.yml`**
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: notify
          uri: lb://NOTIFY-SERVICE
          predicates:
            - Path=/api/notify/**
          filters:
            - RemoveRequestHeader=Cookie
            - AddRequestHeader=X-Request-Id, #{T(java.util.UUID).randomUUID().toString()}
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: https://auth.company/realms/myrealm/protocol/openid-connect/certs
```

**–ö–ª–∞—Å—Å security** (*—É–ø—Ä–æ—â—ë–Ω–Ω–æ*):
```java
@EnableWebSecurity
public class GatewaySecurityConfig {
  @Bean
  SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
    http
      .authorizeExchange(ex -> ex
        .pathMatchers("/public/**").permitAll()
        .anyExchange().authenticated()
      )
      .oauth2ResourceServer(o -> o.jwt()); // –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç JWT –ø–æ JWKS
    return http.build();
  }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è**:
- Gateway –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç JWT (–ø–æ–¥–ø–∏—Å—å, exp, aud/iss).    
- –ú–æ–∂–Ω–æ **–∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å/–∫—ç—à–∏—Ä–æ–≤–∞—Ç—å JWKS** –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ gateway (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–µ—à, TTL).    
- Gateway –º–æ–∂–µ—Ç –∑–∞–º–µ–Ω—è—Ç—å/–æ–±–º–µ–Ω–∏–≤–∞—Ç—å —Ç–æ–∫–µ–Ω (token exchange) –ø–µ—Ä–µ–¥ –≤–Ω—É—Ç—Ä–∏-—Å–µ—Ä–≤–∏—Å–Ω—ã–º –≤—ã–∑–æ–≤–æ–º.    

---
## 2) **NGINX** (*edge*) ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è + –∫—ç—à GET + forward auth

**`nginx.conf`** (*—Ñ—Ä–∞–≥–º–µ–Ω—Ç*):
```nginx
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=1g inactive=10m use_temp_path=off;

server {
  listen 443 ssl;
  server_name api.company.local;

  location /api/ {
    # optional: external auth (token introspection) endpoint
    auth_request /_introspect;

    # cache idempotent GET responses
    proxy_cache api_cache;
    proxy_cache_key "$scheme$proxy_host$request_uri";
    proxy_cache_valid 200 10s;   # short TTL, safe for test/prod tuning
    add_header X-Cache-Status $upstream_cache_status;

    proxy_pass http://backend_pool;
    proxy_set_header Authorization $http_authorization; # forward token or replace
    proxy_set_header X-Request-Id $request_id;
  }

  location = /_introspect {
    internal;
    proxy_pass http://auth-introspect/internal; # introspection implementation
    proxy_pass_request_body off;
    proxy_set_header Content-Length "";
    proxy_set_header X-Original-URI $request_uri;
  }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏—è**:
- `auth_request` –¥–µ–ª–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞ (–º–æ–∂–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç introspection).    
- `proxy_cache` ‚Äî –¥–ª—è GET/—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤; TTL –∫–æ—Ä–æ—Ç–∫–∏–π, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ purge.    

---
## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω—é–∞–Ω—Å—ã / —á—Ç–æ —É–ø–æ–º—è–Ω—É—Ç—å

- ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å:** idempotent GET, JWKS, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã introspection (—Å TTL).    
- ‚ö†Ô∏è **–ù–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å:** –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –±–µ–∑ Vary/—É—Å–ª–æ–≤–∏–π.
- üîÅ **Token exchange / client_credentials:** Gateway –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–±–º–µ–Ω —Ç–æ–∫–µ–Ω–æ–≤ (token exchange) –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å service-to-service token (client_credentials) –∏ –≤—ã–∑–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–µ—Ä–≤–∏—Å –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏.    
- üîí **mTLS** –º–µ–∂–¥—É Gateway –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ ‚Äî –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –¥–æ–≤–µ—Ä–∏—è.    
- üßæ **Observability:** Gateway –¥–æ–±–∞–≤–ª—è–µ—Ç correlation id, —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏/–º–µ—Ç—Ä–∏–∫–∏/traces.
---
