# üìå –†–∞–∑–±–æ—Ä –≤–æ–ø—Ä–æ—Å–∞:

### üîπ –ü–∞—Ä—Ç–∏—Ü–∏—è –∏ –æ—Ñ—Ñ—Å–µ—Ç

- **–ü–∞—Ä—Ç–∏—Ü–∏—è (partition)** ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞. –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é.    
- **–û—Ñ—Ñ—Å–µ—Ç (offset)** ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏.    
üëâ –ü–æ—Ä—è–¥–æ–∫ Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏**.

---
### üîπ –ì–∞—Ä–∞–Ω—Ç–∏–∏ –ø–æ—Ä—è–¥–∫–∞
- –ï—Å–ª–∏ **1 —Ç–æ–ø–∏–∫, 3 –ø–∞—Ä—Ç–∏—Ü–∏–∏, 3 –∫–æ–Ω—Å—å—é–º–µ—Ä–∞ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ**:    
    - –ö–∞–∂–¥—ã–π –∫–æ–Ω—Å—å—é–º–µ—Ä —á–∏—Ç–∞–µ—Ç —Å–≤–æ—é –ø–∞—Ä—Ç–∏—Ü–∏—é.        
    - –í–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –ø–æ—Ä—è–¥–æ–∫ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω**.        
    - –ú–µ–∂–¥—É –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –ø–æ—Ä—è–¥–∫–∞ **–Ω–µ—Ç**.        

---
### üîπ –ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ ¬´–∫–∞–∫ –ø–æ–ª–æ–∂–∏–ª¬ª?
1. –ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —à–ª–∏ –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é.    
2. –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–∫–∞–∑—ã–≤–∞—Ç—å **–∫–ª—é—á (key)**.    
    - Kafka –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –¥–µ–ª–∞–µ—Ç `hash(key) % partitions` ‚Üí –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–∞—Ä—Ç–∏—Ü–∏—é.        
    - –°–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∫–ª—é—á–æ–º –≤—Å–µ–≥–¥–∞ –±—É–¥—É—Ç –≤ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏, –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è.        

---
### üîπ –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è —Å–æ–±–µ—Å–∞
- –ü–∞—Ä—Ç–∏—Ü–∏—è = –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π, –æ—Ñ—Ñ—Å–µ—Ç = –∏—Ö –ø–æ–∑–∏—Ü–∏—è.    
- Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏**.    
- –ü—Ä–∏ 3 –ø–∞—Ä—Ç–∏—Ü–∏—è—Ö –∏ 3 –∫–æ–Ω—Å—å—é–º–µ—Ä–∞—Ö –ø–æ—Ä—è–¥–æ–∫ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏.    
- –ß—Ç–æ–±—ã –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–∏—Ç–∞–ª–∏—Å—å —Å—Ç—Ä–æ–≥–æ –ø–æ –ø–æ—Ä—è–¥–∫—É, –Ω—É–∂–Ω–æ:    
    - –ª–∏–±–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö **—Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∫–ª—é—á–æ–º** ‚Üí –æ–Ω–∏ –ø–æ–ø–∞–¥—É—Ç –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é; 
    - –ª–∏–±–æ –≤–æ–æ–±—â–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **1 –ø–∞—Ä—Ç–∏—Ü–∏—é** (–Ω–æ —Ç–æ–≥–¥–∞ –ø–æ—Ç–µ—Ä—è–µ—à—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å).

------
---
# –í–æ—Ç –≤—ã–∂–∏–º–∫–∞-–∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è —Å–æ–±–µ—Å–∞ (–∫–æ—Ä–æ—Ç–∫–æ, –Ω–æ —Å—É—Ç—å üíØ):
1. **–ü–∞—Ä—Ç–∏—Ü–∏—è** ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞, **–æ—Ñ—Ñ—Å–µ—Ç** ‚Äî –ø–æ–∑–∏—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë.    
2. **–ì–∞—Ä–∞–Ω—Ç–∏—è –ø–æ—Ä—è–¥–∫–∞ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏**, –º–µ–∂–¥—É –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –µ—ë –Ω–µ—Ç. 
3. –ß—Ç–æ–±—ã –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —à–ª–∏ —Å—Ç—Ä–æ–≥–æ –ø–æ –ø–æ—Ä—è–¥–∫—É ‚Üí –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–∫–∞–∑—ã–≤–∞—Ç—å **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–ª—é—á**, —Ç–æ–≥–¥–∞ Kafka –ø–æ–ª–æ–∂–∏—Ç –∏—Ö –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é.

üî• –≠—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á—ë—Ç–∫–∏–π –∏ ¬´–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π¬ª –æ—Ç–≤–µ—Ç –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é.

---
–í–æ—Ç —Ç–∞–∫–æ–π –ª–∞–π—Ñ—Ö–∞–∫-—Ñ—Ä–∞–∑–æ–π –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ—Ç–≤–µ—Ç:

_"–í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –º—ã –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏ –∫–ª—é—á, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –∑–∞–∫–∞–∑–∞, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –ø—Ä–∏ —ç—Ç–æ–º –æ—Å—Ç–∞–≤–ª—è—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –¥—Ä—É–≥–∏–º –∫–ª—é—á–∞–º."_

üí° –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ç—ã **–ø–æ–Ω–∏–º–∞–µ—à—å –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ, –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —Å–º—ã—Å–ª**.

---
---
---
## –í–æ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è **—à–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ `Kafka` –∏ `–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º` –¥–ª—è —Å–æ–±–µ—Å–∞ *Java Middle*** ‚Äî —á—Ç–æ–±—ã –≤—ã–¥–∞–≤–∞—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ:

---
## **Kafka**

### 1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è
- **Topic** ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–∞–Ω–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–π.    
- **Partition** ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º.    
- **Offset** ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏.    
- **Consumer Group** ‚Äî –≥—Ä—É–ø–ø–∞ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤, –∫–∞–∂–¥—ã–π —á–∏—Ç–∞–µ—Ç —Å–≤–æ—é –ø–∞—Ä—Ç–∏—Ü–∏—é.    

---
### 2Ô∏è‚É£ –ü–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–æ—Ä—è–¥–æ–∫ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏**.    
- –ß—Ç–æ–±—ã –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —à–ª–∏ —Å—Ç—Ä–æ–≥–æ –ø–æ –ø–æ—Ä—è–¥–∫—É ‚Üí **—É–∫–∞–∑—ã–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–ª—é—á** –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ.    
- –ï—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç ‚Üí Kafka —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º ‚Üí –ø–æ—Ä—è–¥–æ–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω.    

---
### 3Ô∏è‚É£ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- **At most once** ‚Äî —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä—å.    
- **At least once** ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏.    
- **Exactly once** ‚Äî –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –ø—Ä–æ–¥—é—Å–µ—Ä—ã + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.    
- **acks=all** ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –≤—Å–µ—Ö ISR –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏.    

---
### 4Ô∏è‚É£ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ù–æ–≤—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ ‚Üí –±–æ–ª—å—à–µ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤.    
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π ‚Üí –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.    
- –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥—Ä—É–ø–ø—ã.    

---
### 5Ô∏è‚É£ –ü—Ä–∞–∫—Ç–∏–∫–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
- Spring-Kafka –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.    
- Lag –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Prometheus/Grafana.    
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–ª—é—á—É –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –æ–±—ä–µ–∫—Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, userId, orderId).    
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏, decoupling —Å–µ—Ä–≤–∏—Å–æ–≤, –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.    

---
### 6Ô∏è‚É£ –°–æ–≤–µ—Ç –¥–ª—è —Å–æ–±–µ—Å–∞

> "–í –ø—Ä–æ–µ–∫—Ç–µ –º—ã –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∫–ª—é—á–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –ø—Ä–∏ —ç—Ç–æ–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø–æ –¥—Ä—É–≥–∏–º –∫–ª—é—á–∞–º."

---
