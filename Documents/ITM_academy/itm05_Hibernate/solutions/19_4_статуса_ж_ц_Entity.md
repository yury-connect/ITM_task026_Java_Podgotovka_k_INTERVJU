# ะะฐะบะธะต ัะตัััะต ััะฐัััะฐ ะถะธะทะฝะตะฝะฝะพะณะพ ัะธะบะปะฐ Entity ะพะฑัะตะบัะฐ (Entity Instanceโs Life Cycle) ะฒั ะผะพะถะตัะต ะฟะตัะตัะธัะปะธัั?

---
## ๐ ะะธะทะฝะตะฝะฝัะน ัะธะบะป `Entity` ะฒ *JPA*

| **ะกะพััะพัะฝะธะต**                                 | **ะะฟะธัะฐะฝะธะต**                                                                                                                                                                                                                                                                                                                 |
| --------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ๐  <br>**`Transient`**  <br>_(ะะตัะตัะพะดะฝะพะต)_   | โ ะกััะฝะพัััย**ัะพะปัะบะพ ััะพ ัะพะทะดะฐะฝะฐ**ย(`new`)  <br>โ ะะต ัะฒัะทะฐะฝะฐ ั ะะ/ย`persistence context`  <br>โ ะะต ะธะผะตะตัย`ID`  <br>**ะะพะทะผะพะถะตะฝ**ยะฟะตัะตัะพะด ะฒย`Managed`:  <br>`persist()`ย->ย**`Managed`**ย, ะตัะปะธ ะพะฑัะตะบั ัะฐะฝะตะตย**ะฝะต ะธะผะตะป**ย`ID`  <br>`merge()`ย->ย**`Managed`**, ะฝะพ ัะพะทะดะฐััััย**ะฝะพะฒัะน ะพะฑัะตะบั**, ะฐย**ะฝะต ัะตะบััะธะน**ยัะบะทะตะผะฟะปัั!       |
| โ  <br>**`Managed`**  <br>_(ะฃะฟัะฐะฒะปัะตะผะพะต)_     | โ ะกััะฝะพัััย**ัะฒัะทะฐะฝะฐ**ยัย`Persistence Context`  <br>โ ะฃะฟัะฐะฒะปัะตัััย`EntityManager`  <br>โ ะัะดะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพััะฐะฝะตะฝะฐ ะฟัะธ ะบะพะผะผะธัะต.  <br>**ะะพะทะผะพะถะฝะพ**:  <br>*ย**ัะดะฐะปะธัั**:ย`remove()`ยโย**`Removed`**  <br>*ย**ะพััะพะตะดะธะฝะธัั**:ย`close()`ยะธะปะธย`clear()`ยโย**`Detached`**                                                       |
| ๐  <br>**`Detached`**  <br>_(ะััะพะตะดะธะฝัะฝะฝะพะต)_ | โ ะกััะฝะพัััย**ะธะผะตะตั ID**, ะฝะพย**ะฒะฝะต**ย`Persistence Context`  <br>โ ะะทะผะตะฝะตะฝะธัย**ะฝะต ัะพััะฐะฝััััั ะฐะฒัะพะผะฐัะธัะตัะบะธ**  <br>**ะะพะทะผะพะถะฝะพ**:  <br>*ย**ะฟะพะดะบะปััะธัั ะพะฑัะฐัะฝะพ**ยโย`merge()`ยโ ัะพะทะดะฐัััั ัะฟัะฐะฒะปัะตะผัะน ัะบะทะตะผะฟะปัั (_ะฐย**ะฝะต ัะตะบััะธะน**!_)  <br>*ย**ะฝะฐะนัะธ ะทะฐะฝะพะฒะพ**ยโย`find()`ยะฒะตัะฝััย**ะฝะพะฒัะน**ย`Managed`, ัะตะบััะธะน ะพััะฐะฝะตัััย`Detached` |
| ๐  <br>**`Removed`**  <br>_(ะฃะดะฐะปัะฝะฝะพะต)_      | โ ะกััะฝะพัััย**ะฟะพะผะตัะตะฝะฐ ะฝะฐ ัะดะฐะปะตะฝะธะต**ย(`em.remove(entity)`)  <br>โ ะัั ะตััย`Managed`**ะฝะพ**ยะฑัะดะตั ัะดะฐะปัะฝ ะธะท ะะ ะฟัะธ ะบะพะผะผะธัะต.                                                                                                                                                                                                     |
### ๐ ะะตัะตัะพะดั ะผะตะถะดั ัะพััะพัะฝะธัะผะธ:
**`new`**ยโย`persist()`ยโย**`Managed`**
**`Managed`**ยโย`detach()`ยโย**`Detached`**
**`Managed`**ยโย`remove()`ยโย**`Removed`**ยโย**`Detached`**ย(_ะฟะพัะปะต ะบะพะผะผะธัะฐ_)

[![ะะตัะตัะพะดั ะผะตะถะดั ัะพััะพัะฝะธัะผะธ](https://github.com/yury-connect/ITM_task026_Java_Podgotovka_k_INTERVJU/raw/by_questions/ITM/ITM05_Hibernate/imgs/2025-04-08_18-02-16.png)](https://github.com/yury-connect/ITM_task026_Java_Podgotovka_k_INTERVJU/blob/by_questions/ITM/ITM05_Hibernate/imgs/2025-04-08_18-02-16.png)

> **ะะตัะตัะพะดั ะผะตะถะดั ััะธะผะธ ัะพััะพัะฝะธัะผะธ ะพัััะตััะฒะปััััั ั ะฟะพะผะพััั ะผะตัะพะดะพะฒย`EntityManager`:**
> 
> - **`persist(entity)`**: ะะตัะตะฒะพะดะธั ัััะฝะพััั ะธะท ัะพััะพัะฝะธัย**Transient**ยะฒย**Managed**.  
>     ะัะปะธ ัััะฝะพััั ัะถะตย**Managed**, ะผะตัะพะด ะธะณะฝะพัะธััะตััั.  
>     ะัะปะธ ัััะฝะพัััย**Removed**, ะพะฝะฐ ัะฝะพะฒะฐ ััะฐะฝะพะฒะธัััย**Managed**.
> - **`remove(entity)`**: ะะตัะตะฒะพะดะธั ัััะฝะพััั ะธะท ัะพััะพัะฝะธัย**Managed**ยะฒย**Removed**.  
>     ะัะปะธ ัััะฝะพัััย**Detached**ยะธะปะธย**Transient**, ะฒัะฑัะฐััะฒะฐะตััั ะธัะบะปััะตะฝะธะตย`IllegalArgumentException`.
> - **`merge(entity)`**: ะะฑัะตะดะธะฝัะตั ัะพััะพัะฝะธะต ะฟะตัะตะดะฐะฝะฝะพะน ัััะฝะพััะธ  
>     ั ัััะตััะฒัััะตะน ัะฟัะฐะฒะปัะตะผะพะน ัััะฝะพัััั ะธะปะธ ัะพะทะดะฐัั ะฝะพะฒัั ัะฟัะฐะฒะปัะตะผัั ะบะพะฟะธั.  
>     ะะพะทะฒัะฐัะฐะตั ัะฟัะฐะฒะปัะตะผัั ัััะฝะพััั.  
>     ะัะปะธ ะธััะพะดะฝะฐั ัััะฝะพััั ะฑัะปะฐย**Detached**, ะพะฝะฐ ะพััะฐัััั ะฒ ััะพะผ ัะพััะพัะฝะธะธ.
> - **`detach(entity)`**: ะะตัะตะฒะพะดะธั ัััะฝะพััั ะธะท ัะพััะพัะฝะธัย**Managed**ยะฒย**Detached**, ะฟัะตะบัะฐัะฐั ะตั ะพััะปะตะถะธะฒะฐะฝะธะต ะบะพะฝัะตะบััะพะผ ะฟะตััะธััะตะฝัะธะธ.
> - **`find(entityClass, primaryKey)`**: ะัะปะธ ัััะฝะพััั ั ัะบะฐะทะฐะฝะฝัะผ ะบะปััะพะผ ัััะตััะฒัะตั ะฒ ะบะพะฝัะตะบััะต ะฟะตััะธััะตะฝัะธะธ, ะฒะพะทะฒัะฐัะฐะตั ะตั.  
>     ะ ะฟัะพัะธะฒะฝะพะผ ัะปััะฐะต ะทะฐะณััะถะฐะตั ัััะฝะพััั ะธะท ะฑะฐะทั ะดะฐะฝะฝัั ะธ ะดะตะปะฐะตั ะตัย**Managed**.
> - **`refresh(entity)`**: ะะฑะฝะพะฒะปัะตั ัะพััะพัะฝะธะตย**Managed**ยัััะฝะพััะธ, ะฟะตัะตะทะฐะณััะถะฐั ะดะฐะฝะฝัะต ะธะท ะฑะฐะทั ะดะฐะฝะฝัั.

---

| ะะฟะตัะฐัะธั    | New (ะฝะพะฒัะน)                                              | Managed (ัะฟัะฐะฒะปัะตะผัะน)                                       | Detached (ะพััะพะตะดะธะฝัะฝะฝัะน)                                                  | Removed (ัะดะฐะปัะฝะฝัะน)                                |
| ----------- | -------------------------------------------------------- | ----------------------------------------------------------- | ------------------------------------------------------------------------- | -------------------------------------------------- |
| **persist** | `new โ managed` (ัะพััะฐะฝะธััั ะฒ ะะ ะฟัะธ commit/flush)       | ะะณะฝะพัะธััะตััั (ะฝะพ ะบะฐัะบะฐะดะฝัะต entity ะผะพะณัั ััะฐัั `managed`)    | โ **Exception** (ั detached ัะถะต ะตััั ID)                                  | `removed โ managed` (ะฒะพะทะฒัะฐั ะฒ ัะฟัะฐะฒะปัะตะผัะน ััะฐััั) |
| **remove**  | ะะณะฝะพัะธััะตััั (ะฝะพ ะบะฐัะบะฐะดะฝัะต entity ะผะพะณัั ััะฐัั `removed`) | `managed โ removed` (ัะดะฐะปะธััั ะธะท ะะ ะฟัะธ commit)             | โ **Exception**                                                           | ะะณะฝะพัะธััะตััั                                       |
| **merge**   | ะกะพะทะดะฐัััั ะฝะพะฒะฐั `managed`-ะบะพะฟะธั                          | ะะณะฝะพัะธััะตััั (ะฝะพ ะบะฐัะบะฐะดะฝัะต entity ะพะฑะฝะพะฒะปััััั)              | ะะฐะฝะฝัะต ะบะพะฟะธัััััั ะฒ ัััะตััะฒััััั `managed`-ัััะฝะพััั (ะธะปะธ ัะพะทะดะฐัััั ะฝะพะฒะฐั) | โ **Exception**                                    |
| **refresh** | โ **Exception**                                          | ะะพัััะฐะฝะฐะฒะปะธะฒะฐะตั ะดะฐะฝะฝัะต ะธะท ะะ (ะพัะผะตะฝัะตั ะปะพะบะฐะปัะฝัะต ะธะทะผะตะฝะตะฝะธั) | โ **Exception**                                                           | โ **Exception**                                    |
| **detach**  | โ **Exception** (ะฝะต ะธะผะตะตั ัะผััะปะฐ)                        | `managed โ detached` (ะฑะพะปััะต ะฝะต ะพััะปะตะถะธะฒะฐะตััั)              | ะะณะฝะพัะธััะตััั (ัะถะต `detached`)                                             | `removed โ detached` (ะฟัะตะบัะฐัะฐะตั ะพััะปะตะถะธะฒะฐะฝะธะต)     |



---

## ะัะธะผะตัั ะบะพะดะฐ:

[](https://github.com/yury-connect/ITM_task026_Java_Podgotovka_k_INTERVJU/blob/by_questions/ITM/ITM05_Hibernate/Hibernate.md#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B-%D0%BA%D0%BE%D0%B4%D0%B0)

```java
// ะัะธะผะตั ะฟะตัะตัะพะดะฐ Transient -> Managed
EntityManager em = emf.createEntityManager();
em.getTransaction().begin();
Person person = new Person();
person.setName("ะะฒะฐะฝ");
em.persist(person); // ะขะตะฟะตัั person ะฒ ัะพััะพัะฝะธะธ Managed
em.getTransaction().commit();
em.close();
```

```java
// ะัะธะผะตั ะฟะตัะตัะพะดะฐ Managed -> Detached
EntityManager em = emf.createEntityManager();
em.getTransaction().begin();
Person person = em.find(Person.class, 1L); // person ะฒ ัะพััะพัะฝะธะธ Managed
em.detach(person); // ะขะตะฟะตัั person ะฒ ัะพััะพัะฝะธะธ Detached
em.getTransaction().commit();
em.close();
```

```java
// ะัะธะผะตั ะฟะตัะตัะพะดะฐ Detached -> Managed
EntityManager em = emf.createEntityManager();
em.getTransaction().begin();
Person detachedPerson = new Person();
detachedPerson.setId(1L);
detachedPerson.setName("ะััั");
Person managedPerson = em.merge(detachedPerson); // managedPerson ะฒ ัะพััะพัะฝะธะธ Managed
em.getTransaction().commit();
em.close();
```

---

```
***** ะธะท ะผะตัะพะดะธัะบะธ *****
Transient (New) โ ัะฒะตะถะตัะพะทะดะฐะฝะฝะฐั ะพะฟะตัะฐัะพัะพะผ new() ัััะฝะพััั ะฝะต ะธะผะตะตั ัะฒัะทะธ ั ะฑะฐะทะพะน ะดะฐะฝะฝัั, 
ะฝะต ะธะผะตะตั ะดะฐะฝะฝัั ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั ะธ ะฝะต ะธะผะตะตั ัะณะตะฝะตัะธัะพะฒะฐะฝะฝัั ะฟะตัะฒะธัะฝัั ะบะปััะตะน.

managed - ะพะฑัะตะบั ัะพะทะดะฐะฝ, ัะพััะฐะฝัะฝ ะฒ ะฑะด, ะธะผะตะตั primary key, ัะฟัะฐะฒะปัะตััั JPA
detached -ะพะฑัะตะบั ัะพะทะดะฐะฝ, ะธะผะตะตั primary key, ะฝะต ัะฒะปัะตััั (ะธะปะธ ะฑะพะปััะต ะฝะต ัะฒะปัะตััั) 
    ัะฐัััั ะบะพะฝัะตะบััะฐ ะฟะตััะธััะตะฝัะฝะพััะธ (ะฝะต ัะฟัะฐะฒะปัะตััั JPA);
removed - ะพะฑัะตะบั ัะพะทะดะฐะฝ, ัะฟัะฐะฒะปัะตััั JPA, ะฑัะดะตั ัะดะฐะปะตะฝ ะฟัะธ commit-ะต ะธ ััะฐััั ััะฐะฝะตั ะพะฟััั detached
```
