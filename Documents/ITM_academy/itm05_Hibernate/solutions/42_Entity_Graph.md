# –ß—Ç–æ —Ç–∞–∫–æ–µ `Entity Graph`

---
### üß≠ –ß—Ç–æ —Ç–∞–∫–æ–µ `Entity Graph` –≤ `JPA`/`Hibernate`?
üìå **Entity Graph** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π **–≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–≥—Ä—É–∑–∫–æ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π** (_fetching strategy_) **–Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–ø—Ä–æ—Å–∞, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –≤ –º–æ–¥–µ–ª—è—Ö**.

---
### üéØ –û—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
> **‚ö° –ü–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—É—Ç—ë–º —É–∫–∞–∑–∞–Ω–∏—è, –∫–∞–∫–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ –æ–¥–Ω–æ–º SELECT-–∑–∞–ø—Ä–æ—Å–µ.**

---
### üõ†Ô∏è –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

|**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞**|**–û–ø–∏—Å–∞–Ω–∏–µ**|
|---|---|
|üîÑ **–î–∏–Ω–∞–º–∏—á–Ω–æ—Å—Ç—å**|–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `LAZY` ‚Üí `EAGER` –Ω–∞ –ª–µ—Ç—É, –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ|
|üîó **–ì–∏–±–∫–æ—Å—Ç—å**|–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å, **–∫–∞–∫–∏–µ –ø–æ–ª—è –∏–ª–∏ —Å–≤—è–∑–∏ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å**, –∞ –∫–∞–∫–∏–µ –æ—Å—Ç–∞–≤–∏—Ç—å –ª–µ–Ω–∏–≤—ã–º–∏|
|üì¶ **–û–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å**|–í—Å—ë –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –≤ —Ä–∞–º–∫–∞—Ö **–æ–¥–Ω–æ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞**, –±–µ–∑ N+1!|
|üéõ **–¢–∏–ø—ã –≥—Ä–∞—Ñ–æ–≤**|`NamedEntityGraph` (_—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏_) –∏ `EntityGraph` (_–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏, –≤ –∫–æ–¥–µ_)|

---
### üí° –ü—Ä–∏–º–µ—Ä –ø–æ–ª—å–∑—ã:
–ï—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å User –∏–º–µ–µ—Ç List –∏ Profile, —Ç—ã –º–æ–∂–µ—à—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å–≤—è–∑–∏ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ Profile, –∏–≥–Ω–æ—Ä–∏—Ä—É—è Order, ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–∞–º–æ–π —Å—É—â–Ω–æ—Å—Ç–∏. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏ –±—ã—Å—Ç—Ä–æ!

---
### ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –≥–ª—É–±–∏–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏).
- –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ä–∞–∑–Ω—ã–º–∏ use-case'–∞–º–∏, –≥–¥–µ –Ω—É–∂–Ω—ã —Ä–∞–∑–Ω—ã–µ —Å–≤—è–∑–∏.
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ JOIN FETCH, –∫–æ–≥–¥–∞ –Ω–µ —Ö–æ—á–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å –≤—Ä—É—á–Ω—É—é JPQL-–∑–∞–ø—Ä–æ—Å—ã.

---
### ‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å `JOIN FETCH`:

| |**JOIN FETCH**|**Entity Graph**|
|---|---|---|
|üìÑ –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ JPQL|–î–∞|–ù–µ—Ç|
|üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–µ–µ –≤—ã–±–æ—Ä|‚ùå –í—Å–µ–≥–¥–∞ –≤—Å–µ —Å–≤—è–∑–∏|‚úÖ –¢–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ|
|üõ†Ô∏è –ì–∏–±–∫–æ—Å—Ç—å|–ù–∏–∑–∫–∞—è|–í—ã—Å–æ–∫–∞—è|
|üìö –£–¥–æ–±—Å—Ç–≤–æ –¥–ª—è DTO|–ú–µ–Ω—å—à–µ|–õ—É—á—à–µ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏ —Ç–∏–ø–∞ Spring Data|

---
### üß© –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:
**Entity Graph** ‚Äî —ç—Ç–æ –∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å, —á—Ç–æ –ø–æ–ª–æ–∂–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω–∫—É üß∫ –ø—Ä–∏ –ø–æ—Ö–æ–¥–µ –≤ –ë–î-—Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç: –Ω–µ –Ω—É–∂–Ω–æ —Ç–∞—â–∏—Ç—å –≤—Å—ë –ø–æ–¥—Ä—è–¥, –±–µ—Ä–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ ‚Äî –±—ã—Å—Ç—Ä–æ, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏ —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º üòé

---
### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è EntityGraph –≤ JPA (_Hibernate_)
–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã —Å–æ–∑–¥–∞—ë–º EntityGraph –∏ —Å –µ–≥–æ –ø–æ–º–æ—â—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å—É—â–Ω–æ—Å—Ç–∏ Post —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –ø—Ä–∏ –µ—ë –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –ø–æ–ª—è subject, user, comments. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ comments —Ç–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞–ª–æ—Å—å –ø–æ–ª–µ user. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è subgraphs.

#### –°–æ–∑–¥–∞–Ω–∏–µ EntityGraph —Å –ø–æ–º–æ—â—å—é JPA API
EntityGraph –º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ, –±–µ–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É—è EntityManager:

```java
EntityGraph<Post> entityGraph = entityManager.createEntityGraph(Post.class);
entityGraph.addAttributeNodes("subject");
entityGraph.addAttributeNodes("user");
entityGraph.addSubgraph("comments").addAttributeNodes("user");
```

#### –°–ø–æ—Å–æ–±—ã –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä–∞—Ñ–∞ —Å—É—â–Ω–æ—Å—Ç–∏ –≤ JPA
JPA –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ —É–∫–∞–∑–∞–Ω–∏—è, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏–∑–≤–ª–µ—á—ë–Ω –≥—Ä–∞—Ñ —Å—É—â–Ω–æ—Å—Ç–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

- `fetchgraph` ‚Äî –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –≥—Ä–∞—Ñ–µ –∞—Ç—Ä–∏–±—É—Ç—ã.
    
    > _–ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Hibernate, —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π JPA, –∞—Ç—Ä–∏–±—É—Ç—ã, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–∞–∫ `EAGER`, —Ç–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è._
    
- `loadgraph` ‚Äî –ø–æ–º–∏–º–æ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ –≥—Ä–∞—Ñ–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —Ç–∞–∫–∂–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∞—Ç—Ä–∏–±—É—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–∞–∫ `EAGER` –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—É—â–Ω–æ—Å—Ç–∏.
    

> **–í –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á –∏ –≤–µ—Ä—Å–∏—è (_–µ—Å–ª–∏ —Ç–∞–∫–æ–≤—ã–µ –∏–º–µ—é—Ç—Å—è_) –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ–≥–¥–∞.**

---

```
***** –∏–∑ –º–µ—Ç–æ–¥–∏—á–∫–∏ *****
–û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —à–∞–±–ª–æ–Ω –ø—É—Ç–µ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —Ö–æ—Ç–∏–º –ø–æ–ª—É—á–∏—Ç—å, –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –≤—ã–±–∏—Ä–∞—Ç—å —Ç–∏–ø –≥—Ä–∞—Ñ–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å JPA Entity Graph - —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞–Ω—Ç–∞–π–º–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–∞–∑–æ–≤—ã—Ö –ø–æ–ª–µ–π —Å—É—â–Ω–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π. 
–í–∫—Ä–∞—Ç—Ü–µ, Hibernate –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å –≥—Ä–∞—Ñ –≤ –æ–¥–Ω–æ–º SELECT-–∑–∞–ø—Ä–æ—Å–µ, —Ç–æ –µ—Å—Ç—å –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –æ—Ç –Ω—É–∂–Ω–æ–π –Ω–∞–º —Å—É—â–Ω–æ—Å—Ç–∏:

Entity Graphs ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è fetchType –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
```

---
