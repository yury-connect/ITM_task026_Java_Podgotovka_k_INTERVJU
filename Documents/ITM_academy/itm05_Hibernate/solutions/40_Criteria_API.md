# –ß—Ç–æ —Ç–∞–∫–æ–µ Criteria API –∏ –¥–ª—è —á–µ–≥–æ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

---
[**Criteria API**](https://javarush.com/groups/posts/2259-jpa--znakomstvo-s-tekhnologiey#Criteria-API)¬†–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö¬†**–≤ –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å—Ç–∏–ª–µ**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è¬†**—Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**¬†–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å¬†**–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ**¬†—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.
![](_Attachments_40_Criteria_API/CriteriaAPI_logo.png)

---
### üï∞ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

üî∏ –ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏¬†`Hibernate 5.2`, —Å—Ç–∞—Ä—ã–π¬†`Hibernate Criteria API`¬†(_org.hibernate.Criteria_) –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π (_deprecated_).  
üî∏ üÜï¬†`JPA Criteria API`¬†‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é¬†**JPA**  
üëâ¬†`JPA Criteria API`¬†–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ¬†`API Hibernate`.

---
### üåü –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞¬†_JPA_¬†`Criteria API`:

|üíé¬†**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å**|üìã¬†**–û–ø–∏—Å–∞–Ω–∏–µ**|
|---|---|
|üõ°¬†**–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**|–û—à–∏–±–∫–∏ –º–æ–∂–Ω–æ –æ—Ç–ª–æ–≤–∏—Ç—å —É–∂–µ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ üß†|
|üîÑ¬†**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã**|–§–æ—Ä–º–∏—Ä—É—é—Ç—Å—è ¬´–Ω–∞ –ª–µ—Ç—É¬ª –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è üîß|

---
### ‚ö†Ô∏è¬†–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏¬†_JPA_¬†`Criteria API`:

|‚ùå¬†**–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫**|üìã¬†**–û–ø–∏—Å–∞–Ω–∏–µ**|
|---|---|
|üìú¬†**–ú–Ω–æ–≥–æ—Å–ª–æ–≤–Ω–æ—Å—Ç—å**|–ö–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –≥—Ä–æ–º–æ–∑–¥–∫–∏–º –∏ —Ç—Ä—É–¥–Ω—ã–º –¥–ª—è –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è üëÄ|
|üïπ¬†**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ SQL**|–¢—Ä—É–¥–Ω–µ–µ –¥–æ–±–∏—Ç—å—Å—è –ø–æ–ª–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –°–£–ë–î ‚öôÔ∏è|

### –û–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è JPA¬†`Criteria API`:

|üß©¬†**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å**|üìã¬†**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**|
|---|---|
|üìä¬†**–ê–≥—Ä–µ–≥–∞—Ü–∏—è**|`sum()`,¬†`min()`,¬†`max()`¬†–∏ –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏|
|üéØ¬†**–í—ã–±–æ—Ä –∫–æ–ª–æ–Ω–æ–∫**|–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π —Å¬†`ProjectionList`|
|üîó¬†**JOIN'—ã**|–†–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏:¬†`createAlias()`,¬†`setFetchMode()`|
|üö¶¬†**–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**|–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–µ—Ä–µ–∑¬†`add()`¬†+¬†`Restrictions`|
|üìà¬†**–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**|`addOrder()`¬†‚Äî –∑–∞–¥–∞—ë—Ç –ø–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞|

---
### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ¬†**JPA**¬†`Criteria API`, –µ—Å–ª–∏:
> - üîπ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞¬†**–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏**
> - üîπ –Ω—É–∂–µ–Ω —Å—Ç—Ä–æ–≥–∏–π¬†**–∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–∏–ø–æ–≤**

ü§è –û—Ç–¥–∞–π—Ç–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ¬†**JPQL/HQL**, –µ—Å–ª–∏:
> - üîπ –∑–∞–ø—Ä–æ—Å—ã¬†**–ø—Ä–æ—Å—Ç—ã–µ**¬†–∏ –∑–∞—Ä–∞–Ω–µ–µ¬†**–∏–∑–≤–µ—Å—Ç–Ω—ã**
> - üîπ –≤–∞–∂–Ω–∞¬†**—á–∏—Ç–∞–µ–º–æ—Å—Ç—å**¬†–∏¬†**–∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å**¬†–∫–æ–¥–∞

---
> ‚ú®¬†**–¢–∏–ø–∏—á–Ω—ã–π –≤—ã–±–æ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞**:
> 
> - **–ü—Ä–æ—Å—Ç—ã–µ**¬†—Å—Ç–∞—Ç–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ‚Äî¬†`JPQL`
> - **–°–ª–æ–∂–Ω—ã–µ**, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ ‚Äî¬†`Criteria API`

---
## –ü–†–ò–ú–ï–†  
_–æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞¬†`HQL`¬†–∏ –Ω–∞¬†`JPA Criteria API`_:
### üü¢ HQL:
```java
// HQL
List<User> users = session.createQuery(
    "FROM User WHERE age > :age", User.class)
    .setParameter("age", 18)
    .getResultList();
```

### üü£ Criteria API (JPA):
```java
// Criteria API
CriteriaBuilder cb = entityManager.getCriteriaBuilder();
CriteriaQuery<User> cq = cb.createQuery(User.class);
Root<User> root = cq.from(User.class);
cq.select(root).where(cb.gt(root.get("age"), 18));
List<User> users = entityManager.createQuery(cq).getResultList();
```

### üìå –ö–æ—Ä–æ—Ç–∫–æ –æ —Ä–∞–∑–Ω–∏—Ü–µ:
- `HQL`: –ø—Ä–æ—â–µ –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ, —É–¥–æ–±–µ–Ω –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
- `Criteria API`: –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω, —É–¥–æ–±–µ–Ω –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.

[javarush:¬†**Criteria API**](https://javarush.com/quests/lectures/questhibernate.level16.lecture00)

---

```
***** –∏–∑ –º–µ—Ç–æ–¥–∏—á–∫–∏ *****
–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 5.2 Hibernate Criteria API –æ–±—ä—è–≤–ª–µ–Ω deprecated. 
–í–º–µ—Å—Ç–æ –Ω–µ–≥–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JPA Criteria API.
JPA Criteria API - —ç—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π API, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã–±–æ—Ä–∫–∏(select) 
—Å—É—â–Ω–æ—Å—Ç–µ–π –∏–∑ –ë–î –≤ –±–æ–ª–µ–µ –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å—Ç–∏–ª–µ.

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ JPA Criteria API:
‚ùñ        –æ—à–∏–±–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏;
‚ùñ        –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
‚ùñ        –Ω–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∑–∞–ø—Ä–æ—Å–æ–º, —Å–ª–æ–∂–Ω–æ –æ—Ç–ª–æ–≤–∏—Ç—å –æ—à–∏–±–∫—É
‚ùñ        –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–æ–≤

–î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ - —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–æ–¥–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è 
–≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è - JPA Criteria API —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–π. 

–í–æ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è Criteria API:
Criteria API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–µ–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 
    –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤—Ä–æ–¥–µ sum(), min(), max() –∏ —Ç.–¥.
Criteria API –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ProjectionList –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è 
    –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫.
Criteria API –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥–ª—è join –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é 
    —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü, –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥—ã 
    createAlias(), setFetchMode() –∏ setProjection().
Criteria API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ —É—Å–ª–æ–≤–∏—è–º 
    (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º). –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ add() 
    —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (Restrictions).
Criteria API –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É) 
    –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ addOrder().        
```
---
