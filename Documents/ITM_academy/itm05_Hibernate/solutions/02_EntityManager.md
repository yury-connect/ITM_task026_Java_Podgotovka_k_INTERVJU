# –ß—Ç–æ —Ç–∞–∫–æ–µ¬†`EntityManager`?

üìå¬†**`EntityManager`**¬†‚Äì —ç—Ç–æ <u>–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å *JPA*</u>, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç¬†**–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º**¬†–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç¬†**–æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**¬†—Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –≤ –ë–î.
> **`EntityManager`**¬†–æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞: 
> - **—Å–æ–∑–¥–∞–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ —á—Ç–µ–Ω–∏–µ**¬†—Å—É—â–Ω–æ—Å—Ç–µ–π;
> - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ¬†**—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏**;
> - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ¬†**–∑–∞–ø—Ä–æ—Å–æ–≤**;
> - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å¬†**–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ –≥—Ä–∞—Ñ–∞–º–∏**¬†—Å—É—â–Ω–æ—Å—Ç–µ–π.

---
## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏¬†`EntityManager`:
### üß© –†–∞–±–æ—Ç–∞ —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏:

| **–ú–µ—Ç–æ–¥**   | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                                            |
| ----------- | --------------------------------------------------------- |
| `persist()` | **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ**¬†–Ω–æ–≤–æ–π —Å—É—â–Ω–æ—Å—Ç–∏                             |
| `merge()`   | **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**¬†—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—É—â–Ω–æ—Å—Ç–∏                      |
| `remove()`  | **–£–¥–∞–ª–µ–Ω–∏–µ**¬†—Å—É—â–Ω–æ—Å—Ç–∏                                     |
| `refresh()` | **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**¬†–¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î                               |
| `detach()`  | **–û—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏–µ**¬†—Å—É—â–Ω–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞                     |
| `lock()`    | **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞**¬†—Å—É—â–Ω–æ—Å—Ç–∏ (_–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏_) |
### üß† –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| **–ú–µ—Ç–æ–¥**                   | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**                          |
| --------------------------- | --------------------------------------- |
| `getTransaction()`          | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π                  |
| `getEntityManagerFactory()` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫–∏¬†`EntityManager`       |
| `getCriteriaBuilder()`      | –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (_Criteria API_) |
| `getMetamodel()`            | –î–æ—Å—Ç—É–ø –∫ –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏                 |

### üï∏ –†–∞–±–æ—Ç–∞ —Å –≥—Ä–∞—Ñ–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π

|**–ú–µ—Ç–æ–¥**|**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**|
|---|---|
|`createEntityGraph()`|–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π|
|`getEntityGraph()`|–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞|

### ‚öô –û–±—â–∏–µ –º–µ—Ç–æ–¥—ã

| **–ú–µ—Ç–æ–¥**         | **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**           |
| ----------------- | ------------------------ |
| `close()`         | –ó–∞–∫—Ä—ã—Ç—å¬†`EntityManager`  |
| `clear()`         | –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞        |
| `isOpen()`        | –ü—Ä–æ–≤–µ—Ä–∫–∞, –æ—Ç–∫—Ä—ã—Ç –ª–∏¬†_EM_ |
| `getProperties()` | –ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞¬†_EM_   |
| `setProperty()`   | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞¬†_EM_ |

---
## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ¬†_–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç_?
üîπ –≠—Ç–æ¬†**–∫—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è**, –Ω–∞–±–æ—Ä —Å—É—â–Ω–æ—Å—Ç–µ–π, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–º–∫–∞—Ö¬†**—Ç–µ–∫—É—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.   
üîπ –û–Ω¬†**—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è**¬†`EntityManager`¬†–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.   
üîπ¬†**–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**¬†–∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏:   
- **–∫–æ–º–º–∏—Ç–µ**¬†—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏;
- **–≤—ã–∑–æ–≤–µ¬†`flush()`**.

**‚ùó –í–∞–∂–Ω–æ**:¬†`EntityManager`¬†**–Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω**¬†‚Äì –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å¬†**—Å–≤–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä**.

---
## üîπ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ **JPA**, **JDBC** –∏ **Hibernate**

| `JPA`                  | `JDBC`¬†(_–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ_) | `Hibernate`      |
| ---------------------- | --------------------- | ---------------- |
| `EntityManagerFactory` | `DataSource`          | `SessionFactory` |
| `EntityManager`        | `Connection`          | `Session`        |
| `JPQL`                 | ‚Äî                     | `HQL`            |
###### _–£ **JPQL** –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞ –≤ JDBC, —Ç–∞–∫ –∫–∞–∫ JDBC —Ä–∞–±–æ—Ç–∞–µ—Ç —Å SQL,  –∞ –Ω–µ —Å –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —è–∑—ã–∫–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî –ø–æ—ç—Ç–æ–º—É –≤ —è—á–µ–π–∫–µ —Å—Ç–æ–∏—Ç ¬´‚Äî¬ª._
`EntityManager` ‚Äì —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π *API* **JPA** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç—è–º–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π —É–¥–æ–±–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –ë–î —á–µ—Ä–µ–∑ *–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç*.

---

```
***** –∏–∑ –º–µ—Ç–æ–¥–∏—á–∫–∏ *****
EntityManager –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å JPA, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç API –¥–ª—è –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ Entity, 
–∞ —Ç–∞–∫–∂–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π JPA. 

 –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
 1) –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ Entity: persist (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Entity), merge (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ), 
    remove (—É–¥–∞–ª–µ–Ω–∏—è), refresh (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö), detach (—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ JPA), lock (–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ Entity –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –¥—Ä—É–≥–∏—Ö thread),
 2) –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö: find (–ø–æ–∏—Å–∫ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ Entity), createQuery, createNamedQuery, createNativeQuery, contains, createNamedStoredProcedureQuery, createStoredProcedureQuery
 3) –ü–æ–ª—É—á–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π JPA: getTransaction, getEntityManagerFactory, 
    getCriteriaBuilder, getMetamodel, getDelegate
 4) –†–∞–±–æ—Ç–∞ —Å EntityGraph: createEntityGraph, getEntityGraph
 5) –û–±—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ EntityManager –∏–ª–∏ –≤—Å–µ–º–∏ Entities: close, clear, isOpen, getProperties, setProperty.
 
 –û–±—ä–µ–∫—Ç—ã EntityManager –Ω–µ —è–≤–ª—è—é—Ç—Å—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫  –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä EntityManager, –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º –∏ –∑–∞–∫—Ä—ã—Ç—å –µ–≥–æ –≤ –∫–æ–Ω—Ü–µ.
 
 –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç - —ç—Ç–æ –Ω–∞–±–æ—Ä —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑ –ë–î 
 –∏–ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö. 
 –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —è–≤–ª—è–µ—Ç—Å—è —Å–≤–æ–µ–≥–æ —Ä–æ–¥–∞ –∫—ç—à–µ–º –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ - —ç—Ç–æ –∏ –µ—Å—Ç—å –∫—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è. 
 –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –∏—Ö –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º. 
 EntityManager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –≤ –µ–≥–æ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –≤ –º–æ–º–µ–Ω—Ç –∫–æ–º–º–∏—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ª–∏–±–æ –ø—Ä–∏ —è–≤–Ω–æ–º –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞ flush().
```

---
